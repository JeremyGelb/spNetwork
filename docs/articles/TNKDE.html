<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Temporal Network Kernel Density Estimate â€¢ spNetwork</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Temporal Network Kernel Density Estimate">
<meta property="og:description" content="spNetwork">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spNetwork</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Isochrones.html">Calculating isochrones</a>
    </li>
    <li>
      <a href="../articles/KNetworkFunctions.html">Network k Functions</a>
    </li>
    <li>
      <a href="../articles/NetworkBuilding.html">Building graphs</a>
    </li>
    <li>
      <a href="../articles/NKDE.html">Network Kernel Density Estimate</a>
    </li>
    <li>
      <a href="../articles/NKDEdetailed.html">Details about NKDE</a>
    </li>
    <li>
      <a href="../articles/SpatialWeightMatrices.html">Spatial Weight Matrices</a>
    </li>
    <li>
      <a href="../articles/TNKDE.html">Temporal Network Kernel Density Estimate</a>
    </li>
    <li>
      <a href="../articles/web_vignettes/AdaptiveBW.html">K-nearest neighbour adaptive bandwidth</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JeremyGelb/spNetwork/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Temporal Network Kernel Density Estimate</h1>
                        <h4 data-toc-skip class="author">Jeremy Gelb</h4>
            
            <h4 data-toc-skip class="date">2022-03-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JeremyGelb/spNetwork/blob/HEAD/vignettes/TNKDE.Rmd" class="external-link"><code>vignettes/TNKDE.Rmd</code></a></small>
      <div class="hidden name"><code>TNKDE.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Events recorded on a network often also have a temporal dimension. In that context, one could estimate the density of events in both time and network space.</p>
<p>The spatio-temporal kernel is calculated as the product of the network kernel density and the time kernel density. For a sample point at location <em>l</em> and time <em>t</em>, the Temporal Network Kernel Density Estimate (TNKDE) is calculated as follows:</p>
<p><span class="math display">\[tnkde(l,t) = \frac{1}{bw_{net} * bw_{time}} * \sum^n_{i=1}(k_{net}(d(l,i_l),bw_{net})*k_{time}(d(t,i_t),bw_{time}))\]</span></p>
<p>with:</p>
<ul>
<li>
<span class="math inline">\(k_{net}\)</span> the network kernel density function</li>
<li>
<span class="math inline">\(k_{time}\)</span> the time kernel density function</li>
<li>
<span class="math inline">\(bw_{net}\)</span> the bandwidth used for the network kernel</li>
<li>
<span class="math inline">\(bw_{time}\)</span> the bandwidth used for the time kernel</li>
<li>
<em>n</em> the number of events</li>
<li>
<em>i</em> an event at location <span class="math inline">\(i_l\)</span> and time <span class="math inline">\(i_t\)</span>
</li>
<li>
<span class="math inline">\(d(a,b)\)</span> the distance (in time or space) between <em>a</em> and <em>b</em>
</li>
</ul>
<p>As specified in the previous formula, two bandwidths are necessary, one for space and one for time.</p>
<p>We give in this vignette a short example with bike accidents data in 2016 in the central districts of Montreal.</p>
</div>
<div class="section level2">
<h2 id="temporal-dimension">Temporal dimension<a class="anchor" aria-label="anchor" href="#temporal-dimension"></a>
</h2>
<p>We start here by exploring the density of events in time.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># first load data and packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jeremygelb.github.io/spNetwork/" class="external-link">spNetwork</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mtennekes/tmap" class="external-link">tmap</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>

<span class="va">eventsgpkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"events.gpkg"</span>, package <span class="op">=</span> <span class="st">"spNetwork"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">bike_accidents</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">eventsgpkg</span>,layer<span class="op">=</span><span class="st">"bike_accidents"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># converting the Date field to a numeric field (counting days)</span>
<span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Date</span>, format <span class="op">=</span> <span class="st">"%Y/%m/%d"</span><span class="op">)</span>
<span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2016/01/01"</span>, format <span class="op">=</span> <span class="st">"%Y/%m/%d"</span><span class="op">)</span>
<span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span>, <span class="va">start</span>, units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span>
<span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span><span class="op">)</span>

<span class="va">months</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>
<span class="va">months</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">months</span><span class="op">)</span><span class="op">==</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="va">months</span><span class="op">)</span>, <span class="va">months</span><span class="op">)</span>
<span class="va">months_starts_labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"2016/"</span>,<span class="va">months</span>,<span class="st">"/01"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="va">months_starts_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">months_starts_labs</span>, format <span class="op">=</span> <span class="st">"%Y/%m/%d"</span><span class="op">)</span>
<span class="va">months_starts_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">months_starts_num</span>, <span class="va">start</span>, units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span>
<span class="va">months_starts_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">months_starts_num</span><span class="op">)</span>
<span class="va">months_starts_labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"2016/"</span>, <span class="st">""</span>, <span class="va">months_starts_labs</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">30</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">months_starts_num</span>, labels <span class="op">=</span> <span class="va">months_starts_labs</span><span class="op">)</span></code></pre></div>
<p><img src="TNKDE_files/figure-html/unnamed-chunk-2-1.png" width="70%"></p>
<p>It is not surprising to observe that most of the accidents occur during spring, summer, and fall. We will remove the lonely observations during the three first months of the year because they might influence the bandwidthsâ€™ size latter.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bike_accidents</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">bike_accidents</span>, <span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span> <span class="op">&gt;=</span> <span class="fl">90</span><span class="op">)</span></code></pre></div>
<p>We can now calculate the kernel density values in time for several bandwidths.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">)</span><span class="op">)</span>
<span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span><span class="op">)</span>, <span class="fl">0.5</span><span class="op">)</span>

<span class="va">time_kernel_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
  bw_10 <span class="op">=</span> <span class="fu"><a href="../reference/tkde.html">tkde</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span>, w <span class="op">=</span> <span class="va">w</span>, samples <span class="op">=</span> <span class="va">samples</span>, bw <span class="op">=</span> <span class="fl">10</span>, kernel_name <span class="op">=</span> <span class="st">"quartic"</span><span class="op">)</span>,
  bw_20 <span class="op">=</span> <span class="fu"><a href="../reference/tkde.html">tkde</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span>, w <span class="op">=</span> <span class="va">w</span>, samples <span class="op">=</span> <span class="va">samples</span>, bw <span class="op">=</span> <span class="fl">20</span>, kernel_name <span class="op">=</span> <span class="st">"quartic"</span><span class="op">)</span>,
  bw_30 <span class="op">=</span> <span class="fu"><a href="../reference/tkde.html">tkde</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span>, w <span class="op">=</span> <span class="va">w</span>, samples <span class="op">=</span> <span class="va">samples</span>, bw <span class="op">=</span> <span class="fl">30</span>, kernel_name <span class="op">=</span> <span class="st">"quartic"</span><span class="op">)</span>,
  bw_40 <span class="op">=</span> <span class="fu"><a href="../reference/tkde.html">tkde</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span>, w <span class="op">=</span> <span class="va">w</span>, samples <span class="op">=</span> <span class="va">samples</span>, bw <span class="op">=</span> <span class="fl">40</span>, kernel_name <span class="op">=</span> <span class="st">"quartic"</span><span class="op">)</span>,
  bw_50 <span class="op">=</span> <span class="fu"><a href="../reference/tkde.html">tkde</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span>, w <span class="op">=</span> <span class="va">w</span>, samples <span class="op">=</span> <span class="va">samples</span>, bw <span class="op">=</span> <span class="fl">50</span>, kernel_name <span class="op">=</span> <span class="st">"quartic"</span><span class="op">)</span>,
  bw_60 <span class="op">=</span> <span class="fu"><a href="../reference/tkde.html">tkde</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span>, w <span class="op">=</span> <span class="va">w</span>, samples <span class="op">=</span> <span class="va">samples</span>, bw <span class="op">=</span> <span class="fl">60</span>, kernel_name <span class="op">=</span> <span class="st">"quartic"</span><span class="op">)</span>,
  time <span class="op">=</span> <span class="va">samples</span>
<span class="op">)</span>

<span class="va">df_time</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">time_kernel_values</span>,id.vars <span class="op">=</span> <span class="st">"time"</span><span class="op">)</span>
<span class="va">df_time</span><span class="op">$</span><span class="va">variable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">df_time</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_time</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">months_starts_num</span>, labels <span class="op">=</span> <span class="va">months_starts_labs</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="TNKDE_files/figure-html/unnamed-chunk-4-1.png" width="80%"></p>
<p>It seems that a bandwidth between 30 and 40 days capture the bimodal shape of the temporal dimension of bike accidents. The lower densities during July and August are likely caused by the lower traffic due to holidays.</p>
<p>It is also possible to use the classical functions from R to find a bandwidth with a datadriven approach.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bw1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/bandwidth.html" class="external-link">bw.bcv</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span>, nb <span class="op">=</span> <span class="fl">1000</span>, lower <span class="op">=</span> <span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">80</span><span class="op">)</span>
<span class="va">bw2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/bandwidth.html" class="external-link">bw.ucv</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span>, nb <span class="op">=</span> <span class="fl">1000</span>, lower <span class="op">=</span> <span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">80</span><span class="op">)</span>
<span class="va">bw3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/bandwidth.html" class="external-link">bw.SJ</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span>, nb <span class="op">=</span> <span class="fl">1000</span>, lower <span class="op">=</span> <span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">80</span><span class="op">)</span>


<span class="va">time_kernel_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
  bw_bcv <span class="op">=</span> <span class="fu"><a href="../reference/tkde.html">tkde</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span>, w <span class="op">=</span> <span class="va">w</span>, samples <span class="op">=</span> <span class="va">samples</span>, bw <span class="op">=</span> <span class="va">bw1</span>, kernel_name <span class="op">=</span> <span class="st">"quartic"</span><span class="op">)</span>,
  bw_ucv <span class="op">=</span> <span class="fu"><a href="../reference/tkde.html">tkde</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span>, w <span class="op">=</span> <span class="va">w</span>, samples <span class="op">=</span> <span class="va">samples</span>, bw <span class="op">=</span> <span class="va">bw2</span>, kernel_name <span class="op">=</span> <span class="st">"quartic"</span><span class="op">)</span>,
  bw_SJ <span class="op">=</span> <span class="fu"><a href="../reference/tkde.html">tkde</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span>, w <span class="op">=</span> <span class="va">w</span>, samples <span class="op">=</span> <span class="va">samples</span>, bw <span class="op">=</span> <span class="va">bw3</span>, kernel_name <span class="op">=</span> <span class="st">"quartic"</span><span class="op">)</span>,
  time <span class="op">=</span> <span class="va">samples</span>
<span class="op">)</span>

<span class="va">df_time</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">time_kernel_values</span>,id.vars <span class="op">=</span> <span class="st">"time"</span><span class="op">)</span>
<span class="va">df_time</span><span class="op">$</span><span class="va">variable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">df_time</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_time</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">months_starts_num</span>, labels <span class="op">=</span> <span class="va">months_starts_labs</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span>  <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="TNKDE_files/figure-html/unnamed-chunk-5-1.png" width="80%"></p>
<p>In that case, the automatic bandwidth selection methods yield much more noisy results with small bandwidths. Bike accidents are rare events and too small time bandwidths would create results with meaningless hot spots.</p>
</div>
<div class="section level2">
<h2 id="spatial-dimension">Spatial dimension<a class="anchor" aria-label="anchor" href="#spatial-dimension"></a>
</h2>
<p>Before considering the spatio-temporal case, we can also investigate the temporal dimension.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># loading the road network</span>
<span class="va">networkgpkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"networks.gpkg"</span>, package <span class="op">=</span> <span class="st">"spNetwork"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">mtl_network</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">networkgpkg</span>,layer<span class="op">=</span><span class="st">"mtl_network"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">mtl_network</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></code></pre></div>
<p><img src="TNKDE_files/figure-html/unnamed-chunk-6-1.png" width="75%" style="display: block; margin: auto;"></p>
<p>As suggested in the vignette NKDE, we will use an adaptive bandwidth of 450 metres for the discontinuous kernel.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># creating sample points</span>
<span class="va">lixels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lixelize_lines.html">lixelize_lines</a></span><span class="op">(</span><span class="va">mtl_network</span>, <span class="fl">50</span><span class="op">)</span>
<span class="va">sample_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lines_center.html">lines_center</a></span><span class="op">(</span><span class="va">lixels</span><span class="op">)</span>

<span class="co"># calculating the densities</span>
<span class="va">nkde_densities</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nkde.html">nkde</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="va">mtl_network</span>,
                       events <span class="op">=</span> <span class="va">bike_accidents</span>,
                       w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">)</span><span class="op">)</span>,
                       samples <span class="op">=</span> <span class="va">sample_points</span>,
                       kernel_name <span class="op">=</span> <span class="st">"quartic"</span>,
                       bw <span class="op">=</span> <span class="fl">450</span>,
                       adaptive <span class="op">=</span> <span class="cn">TRUE</span>, trim_bw <span class="op">=</span> <span class="fl">900</span>,
                       method <span class="op">=</span> <span class="st">"discontinuous"</span>,
                       div <span class="op">=</span> <span class="st">"bw"</span>,
                       max_depth <span class="op">=</span> <span class="fl">10</span>,
                       digits <span class="op">=</span> <span class="fl">2</span>, tol <span class="op">=</span> <span class="fl">0.1</span>, agg <span class="op">=</span> <span class="fl">5</span>,
                       grid_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,
                       verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">sample_points</span><span class="op">$</span><span class="va">density</span> <span class="op">&lt;-</span> <span class="va">nkde_densities</span><span class="op">$</span><span class="va">k</span> <span class="op">*</span> <span class="fl">1000</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">sample_points</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"density"</span>, style <span class="op">=</span> <span class="st">"kmeans"</span>, n <span class="op">=</span> <span class="fl">8</span>, palette <span class="op">=</span> <span class="st">"viridis"</span>, size <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="TNKDE_files/figure-html/unnamed-chunk-8-1.png" width="75%" style="display: block; margin: auto;"></p>
<p>Several hot spots could already be identified, but we have no information about their location in time. The previous map represent the average density during the full period.</p>
</div>
<div class="section level2">
<h2 id="spatio-temporal">Spatio-temporal<a class="anchor" aria-label="anchor" href="#spatio-temporal"></a>
</h2>
<p>We can now estimate the kernel density in both space and time. Note that increasing the dimension leads to larger bandwidths.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cv_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bws_tnkde_cv_likelihood_calc.html">bws_tnkde_cv_likelihood_calc</a></span><span class="op">(</span>
  bw_net_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">1000</span><span class="op">)</span>,
  bw_net_step <span class="op">=</span> <span class="fl">100</span>,
  bw_time_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">60</span><span class="op">)</span>,
  bw_time_step <span class="op">=</span> <span class="fl">10</span>,
  lines <span class="op">=</span> <span class="va">mtl_network</span>,
  events <span class="op">=</span> <span class="va">bike_accidents</span>,
  time_field <span class="op">=</span> <span class="st">"Time"</span>,
  w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">)</span><span class="op">)</span>,
  kernel_name <span class="op">=</span> <span class="st">"quartic"</span>,
  method <span class="op">=</span> <span class="st">"discontinuous"</span>,
  diggle_correction <span class="op">=</span> <span class="cn">FALSE</span>,
  study_area <span class="op">=</span> <span class="cn">NULL</span>,
  max_depth <span class="op">=</span> <span class="fl">10</span>,
  digits <span class="op">=</span> <span class="fl">2</span>,
  tol <span class="op">=</span> <span class="fl">0.1</span>,
  agg <span class="op">=</span> <span class="fl">15</span>,
  sparse<span class="op">=</span><span class="cn">TRUE</span>,
  grid_shape<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,
  sub_sample<span class="op">=</span><span class="fl">1</span>,
  verbose <span class="op">=</span> <span class="cn">FALSE</span>,
  check <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">cv_scores</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">10</th>
<th align="right">20</th>
<th align="right">30</th>
<th align="right">40</th>
<th align="right">50</th>
<th align="right">60</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">100</td>
<td align="right">-685.83950</td>
<td align="right">-653.22875</td>
<td align="right">-643.02542</td>
<td align="right">-622.70580</td>
<td align="right">-596.23889</td>
<td align="right">-559.70551</td>
</tr>
<tr class="even">
<td align="left">200</td>
<td align="right">-587.78721</td>
<td align="right">-489.93581</td>
<td align="right">-453.39381</td>
<td align="right">-408.76247</td>
<td align="right">-366.04623</td>
<td align="right">-339.61319</td>
</tr>
<tr class="odd">
<td align="left">300</td>
<td align="right">-491.89467</td>
<td align="right">-367.76273</td>
<td align="right">-302.90003</td>
<td align="right">-240.13611</td>
<td align="right">-199.50315</td>
<td align="right">-159.13310</td>
</tr>
<tr class="even">
<td align="left">400</td>
<td align="right">-398.34746</td>
<td align="right">-233.82342</td>
<td align="right">-183.04833</td>
<td align="right">-134.51254</td>
<td align="right">-102.11038</td>
<td align="right">-79.89645</td>
</tr>
<tr class="odd">
<td align="left">500</td>
<td align="right">-270.19972</td>
<td align="right">-134.30754</td>
<td align="right">-83.69314</td>
<td align="right">-59.46574</td>
<td align="right">-47.27078</td>
<td align="right">-31.17834</td>
</tr>
<tr class="even">
<td align="left">600</td>
<td align="right">-190.87619</td>
<td align="right">-99.59623</td>
<td align="right">-63.26606</td>
<td align="right">-41.08428</td>
<td align="right">-32.99876</td>
<td align="right">-28.99715</td>
</tr>
<tr class="odd">
<td align="left">700</td>
<td align="right">-132.13711</td>
<td align="right">-71.16703</td>
<td align="right">-45.00193</td>
<td align="right">-32.92317</td>
<td align="right">-28.89739</td>
<td align="right">-24.95923</td>
</tr>
<tr class="even">
<td align="left">800</td>
<td align="right">-105.43621</td>
<td align="right">-52.89599</td>
<td align="right">-34.79394</td>
<td align="right">-28.83834</td>
<td align="right">-28.87788</td>
<td align="right">-24.96493</td>
</tr>
<tr class="odd">
<td align="left">900</td>
<td align="right">-73.14281</td>
<td align="right">-42.66780</td>
<td align="right">-30.69131</td>
<td align="right">-26.80878</td>
<td align="right">-26.89946</td>
<td align="right">-25.01179</td>
</tr>
<tr class="even">
<td align="left">1000</td>
<td align="right">-66.74994</td>
<td align="right">-38.62177</td>
<td align="right">-28.70325</td>
<td align="right">-26.83303</td>
<td align="right">-26.94546</td>
<td align="right">-25.07208</td>
</tr>
</tbody>
</table>
<p>According to the leave one out cross validation method, the optimal set of bandwidths is 700 metres and 60 days. As expected, larger bandwidths are required because the density of the events are spread both in space and time.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># choosing sample in times (every 10 days)</span>
<span class="va">sample_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">Time</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>

<span class="co"># calculating densities</span>
<span class="va">tnkde_densities</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tnkde.html">tnkde</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="va">mtl_network</span>,
                   events <span class="op">=</span> <span class="va">bike_accidents</span>, time_field <span class="op">=</span> <span class="st">"Time"</span>, w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">)</span><span class="op">)</span>, 
                   samples_loc <span class="op">=</span> <span class="va">sample_points</span>, samples_time <span class="op">=</span> <span class="va">sample_time</span>, 
                   kernel_name <span class="op">=</span> <span class="st">"quartic"</span>, bw_net <span class="op">=</span> <span class="fl">700</span>, bw_time <span class="op">=</span> <span class="fl">60</span>, adaptive <span class="op">=</span> <span class="cn">TRUE</span>,
                   trim_bw_net <span class="op">=</span> <span class="fl">900</span>, trim_bw_time <span class="op">=</span> <span class="fl">80</span>, method <span class="op">=</span> <span class="st">"discontinuous"</span>,
                   div <span class="op">=</span> <span class="st">"bw"</span>, max_depth <span class="op">=</span> <span class="fl">10</span>, digits <span class="op">=</span> <span class="fl">2</span>, tol <span class="op">=</span> <span class="fl">0.01</span>, agg <span class="op">=</span> <span class="fl">15</span>, grid_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, 
                   verbose  <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># creating a color palette for all the densities</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/classInt/" class="external-link">classInt</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span>
<span class="va">all_densities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tnkde_densities</span><span class="op">$</span><span class="va">k</span><span class="op">)</span>
<span class="va">color_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/classInt/reference/classIntervals.html" class="external-link">classIntervals</a></span><span class="op">(</span><span class="va">all_densities</span>, n <span class="op">=</span> <span class="fl">10</span>, style <span class="op">=</span> <span class="st">"kmeans"</span><span class="op">)</span>

<span class="co"># generating a map at each sample time</span>
<span class="va">all_maps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">tnkde_densities</span><span class="op">$</span><span class="va">k</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span>
  <span class="va">time</span> <span class="op">&lt;-</span> <span class="va">sample_time</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
  <span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">start</span><span class="op">)</span> <span class="op">+</span> <span class="va">time</span>
  
  <span class="va">sample_points</span><span class="op">$</span><span class="va">density</span> <span class="op">&lt;-</span> <span class="va">tnkde_densities</span><span class="op">$</span><span class="va">k</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>
  <span class="va">map1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">sample_points</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"density"</span>, size <span class="op">=</span> <span class="fl">0.01</span>,
          breaks <span class="op">=</span> <span class="va">color_breaks</span><span class="op">$</span><span class="va">brks</span>, palette <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.show<span class="op">=</span><span class="cn">FALSE</span>, main.title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, main.title.size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">map1</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="co"># creating a gif with all the maps</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_animation.html" class="external-link">tmap_animation</a></span><span class="op">(</span><span class="va">all_maps</span>, filename <span class="op">=</span> <span class="st">"images/animated_map.gif"</span>, 
               width <span class="op">=</span> <span class="fl">1000</span>, height <span class="op">=</span> <span class="fl">1000</span>, dpi <span class="op">=</span> <span class="fl">300</span>, delay <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html" class="external-link">include_graphics</a></span><span class="op">(</span><span class="st">"images/animated_map.gif"</span><span class="op">)</span></code></pre></div>
<p><img src="images/animated_map.gif" width="75%" style="display: block; margin: auto;"></p>
<p>The locations of the hot spots are changing during the year. This information was hidden when only a spatial NKDE was used.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jeremy Gelb.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
