<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analysing the impact of max_dept parameter for continuous NKDE â€¢ spNetwork</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Analysing the impact of max_dept parameter for continuous NKDE">
<meta property="og:description" content="spNetwork">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">spNetwork</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.4.5.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/web_vignettes/AdaptiveBW.html">K-nearest neighbour adaptive bandwidth</a>
    </li>
    <li>
      <a href="../../articles/web_vignettes/Isochrones.html">Calculating isochrones</a>
    </li>
    <li>
      <a href="../../articles/KNetworkFunctions.html">Network k Functions</a>
    </li>
    <li>
      <a href="../../articles/NetworkBuilding.html">Building graphs</a>
    </li>
    <li>
      <a href="../../articles/NKDE.html">Network Kernel Density Estimate</a>
    </li>
    <li>
      <a href="../../articles/web_vignettes/NKDEdetailed.html">Details about NKDE</a>
    </li>
    <li>
      <a href="../../articles/web_vignettes/SpaceTimeDBscan.html">Spatio-temporal dbscan with network distance</a>
    </li>
    <li>
      <a href="../../articles/SpatialWeightMatrices.html">Spatial Weight Matrices</a>
    </li>
    <li>
      <a href="../../articles/web_vignettes/SpeedVSprecision.html">Analysing the impact of max_dept parameter for continuous NKDE</a>
    </li>
    <li>
      <a href="../../articles/TNKDE.html">Temporal Network Kernel Density Estimate</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JeremyGelb/spNetwork/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Analysing the impact of max_dept parameter for
continuous NKDE</h1>
                        <h4 data-toc-skip class="author">Jeremy
Gelb</h4>
            
            <h4 data-toc-skip class="date">2025-03-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JeremyGelb/spNetwork/blob/HEAD/vignettes/web_vignettes/SpeedVSprecision.Rmd" class="external-link"><code>vignettes/web_vignettes/SpeedVSprecision.Rmd</code></a></small>
      <div class="hidden name"><code>SpeedVSprecision.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette, we quantify the impact of the parameter
<code>max_dept</code> on the precision of the calculation of the
continuous NKDE.</p>
<p>The continuous NKDE is obtained by a recursive algorithm correcting
the density values along the network when a intersection is encountered.
This is the only NKDE that needs to go backward during its calculation
and this makes it the slowest approach in terms of computation time.</p>
<p>The parameter <code>max_dept</code> can be used to limit the number
of recursions at the cost of a loss in precision. Indeed, at each
intersection the density is split in each direction. After a few
intersections, it could be considered safe to stop the calculation. The
gain in precision is likely not worth the computation time.</p>
<p>In this vignette, we gives some insights about the size of the impact
of the parameter <code>max_dept</code>.</p>
<p>We will calculate the impact of the parameter <code>max_dept</code>
given several bandwidth for the data <code>bike_accidents</code>.</p>
<p>For each bandwidth, we will recalculate the density with a
<code>max_dept</code> value going from 4 to 14. We will then compare the
densities obtained with the reference value (highest
<code>max_dept</code>). The differences will be summarized with a scaled
root mean square error.</p>
<p><span class="math display">\[ SRMSE = \sqrt(\frac{{RMSE}}{\delta})
\]</span> with <span class="math inline">\(\delta\)</span> equal to the
interquartile range for the reference density values.</p>
</div>
<div class="section level2">
<h2 id="preparing-the-data">Preparing the data<a class="anchor" aria-label="anchor" href="#preparing-the-data"></a>
</h2>
<p>We start here by loading the data and preparing the parameters.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first load data and packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jeremygelb.github.io/spNetwork/" class="external-link">spNetwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.apply.futureverse.org" class="external-link">future.apply</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mtl_network</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lixels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/lixelize_lines.html">lixelize_lines</a></span><span class="op">(</span><span class="va">mtl_network</span>,<span class="fl">200</span>,mindist <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/lines_center.html">lines_center</a></span><span class="op">(</span><span class="va">lixels</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we select here the bandwidths for calculation</span></span>
<span><span class="va">bws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">200</span>,<span class="fl">1000</span>,<span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we select here the max_depth values</span></span>
<span><span class="va">max_depths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">14</span>,<span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we create here the dataframe will all the parameters</span></span>
<span><span class="va">params_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  bw <span class="op">=</span> <span class="va">bws</span>,</span>
<span>  max_depth <span class="op">=</span> <span class="va">max_depths</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we shuffle the dataframe to make the multicore processing</span></span>
<span><span class="co"># balanced</span></span>
<span><span class="va">params_df</span> <span class="op">&lt;-</span> <span class="va">params_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">params_df</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">params_df</span><span class="op">$</span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">params_df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">params_df</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">params_df</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can now start the heavy work. We will use multiprocessing to
reduce calculation time.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">multisession</a></span><span class="op">(</span>workers<span class="op">=</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/progressor.html" class="external-link">progressor</a></span><span class="op">(</span>along <span class="op">=</span> <span class="va">items</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">all_densities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://future.apply.futureverse.org/reference/future_lapply.html" class="external-link">future_lapply</a></span><span class="op">(</span><span class="va">items</span>, <span class="kw">function</span><span class="op">(</span><span class="va">row</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>          <span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/nkde.html">nkde</a></span><span class="op">(</span><span class="va">mtl_network</span>,</span>
<span>               events <span class="op">=</span> <span class="va">bike_accidents</span>,</span>
<span>               w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               samples <span class="op">=</span> <span class="va">samples</span>,</span>
<span>               kernel_name <span class="op">=</span> <span class="st">"quartic"</span>,</span>
<span>               bw <span class="op">=</span> <span class="va">row</span><span class="op">$</span><span class="va">bw</span>, div<span class="op">=</span> <span class="st">"bw"</span>,</span>
<span>               adaptive <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>               method <span class="op">=</span> <span class="st">"continuous"</span>, digits <span class="op">=</span> <span class="fl">1</span>, tol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>               max_depth <span class="op">=</span> <span class="va">row</span><span class="op">$</span><span class="va">max_depth</span>,</span>
<span>               agg <span class="op">=</span> <span class="fl">10</span>,</span>
<span>               grid_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>               verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="fu">p</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"i=%g"</span>, <span class="va">row</span><span class="op">$</span><span class="va">index</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">values</span>, <span class="va">t1</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span>, future.packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spNetwork"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="impacts-on-calculation-time">Impacts on calculation time<a class="anchor" aria-label="anchor" href="#impacts-on-calculation-time"></a>
</h2>
<p>We start here by assessing how much the calculation time is affected
by the increase in the bandwidth and the <code>max_depth</code>
parameter.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">params_df</span><span class="op">$</span><span class="va">durations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">all_densities</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="va">i</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">}</span><span class="op">)</span> <span class="op">/</span> <span class="fl">60</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">params_df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bw</span>, y <span class="op">=</span> <span class="va">max_depth</span>, fill <span class="op">=</span> <span class="va">durations</span><span class="op">)</span>,  size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bw</span>, y <span class="op">=</span> <span class="va">max_depth</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">durations</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'bandwidth (m)'</span>, y <span class="op">=</span> <span class="st">'max_depth'</span>, fill <span class="op">=</span> <span class="st">'duration (min)'</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpeedVSprecision_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
<p>As one can see, the calculation time (in minutes) grows fast with the
increasing bandwidth and <code>max_depth</code>. For a small dataset as
presented in this vignette and a bandwidth of 1000m, using a
<code>max_depth</code> of 8 instead of 10 can divide the calculation
time by 10 and by 300 in comparison with the value of 14.</p>
</div>
<div class="section level2">
<h2 id="impact-on-the-results">Impact on the results<a class="anchor" aria-label="anchor" href="#impact-on-the-results"></a>
</h2>
<p>The reduction in calculation time is very interesting. However, we
must check now how much it affects the estimated densities.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">references</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">params_df</span>, <span class="va">params_df</span><span class="op">$</span><span class="va">max_depth</span> <span class="op">==</span> <span class="fl">14</span><span class="op">)</span></span>
<span><span class="va">comparisons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">params_df</span>, <span class="va">params_df</span><span class="op">$</span><span class="va">max_depth</span> <span class="op">!=</span> <span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">comparisons</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">row</span> <span class="op">&lt;-</span> <span class="va">comparisons</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">idx1</span> <span class="op">&lt;-</span> <span class="va">row</span><span class="op">$</span><span class="va">index</span></span>
<span>  <span class="va">comp</span> <span class="op">&lt;-</span> <span class="va">all_densities</span><span class="op">[[</span><span class="va">idx1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">idx2</span> <span class="op">&lt;-</span> <span class="va">references</span><span class="op">$</span><span class="va">index</span><span class="op">[</span><span class="va">references</span><span class="op">$</span><span class="va">bw</span> <span class="op">==</span> <span class="va">row</span><span class="op">$</span><span class="va">bw</span><span class="op">]</span></span>
<span>  <span class="va">ref</span> <span class="op">&lt;-</span> <span class="va">all_densities</span><span class="op">[[</span><span class="va">idx2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">ref</span>, probs <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">ref</span>, probs <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">ref</span> <span class="op">-</span> <span class="va">comp</span><span class="op">)</span> <span class="op">**</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">range</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">row</span><span class="op">$</span><span class="va">bw</span>, <span class="va">row</span><span class="op">$</span><span class="va">max_dept</span>, <span class="va">error</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'bw'</span>, <span class="st">'max_depth'</span>, <span class="st">'error'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bw</span>, y <span class="op">=</span> <span class="va">max_depth</span>, fill <span class="op">=</span> <span class="va">error</span><span class="op">)</span>,  size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bw</span>, y <span class="op">=</span> <span class="va">max_depth</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">error</span><span class="op">*</span><span class="fl">10</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">comparisons</span><span class="op">$</span><span class="va">max_depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">comparisons</span><span class="op">$</span><span class="va">bw</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'bandwidth (m)'</span>, y <span class="op">=</span> <span class="st">'max_depth'</span>, fill <span class="op">=</span> <span class="st">'scaled RMSE'</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpeedVSprecision_files/figure-html/unnamed-chunk-5-1.png" width="100%"></p>
<p>As expected, the scaled RMSE is higher with a larger bandwidth and a
smaller <code>max_depth</code>. Considering the link with the bandwidth,
we will focus on the results obtained with the largest one (1000m).</p>
<p>To do so, we calculate the relative differences between the reference
values (obtained with <code>max_depth = 14</code>) and the approximate
values.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ok_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">params_df</span>, <span class="va">params_df</span><span class="op">$</span><span class="va">bw</span> <span class="op">==</span> <span class="fl">1000</span> <span class="op">&amp;</span> <span class="va">params_df</span><span class="op">$</span><span class="va">max_depth</span> <span class="op">!=</span> <span class="fl">14</span><span class="op">)</span></span>
<span><span class="va">reference</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">params_df</span>, <span class="va">params_df</span><span class="op">$</span><span class="va">bw</span> <span class="op">==</span> <span class="fl">1000</span> <span class="op">&amp;</span> <span class="va">params_df</span><span class="op">$</span><span class="va">max_depth</span> <span class="op">==</span> <span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ok_ids</span> <span class="op">&lt;-</span> <span class="va">ok_ids</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">ok_ids</span><span class="op">$</span><span class="va">max_depth</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">ref</span> <span class="op">&lt;-</span> <span class="va">all_densities</span><span class="op">[</span><span class="va">reference</span><span class="op">$</span><span class="va">index</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="va">all_densities</span><span class="op">[</span><span class="va">ok_ids</span><span class="op">$</span><span class="va">index</span><span class="op">]</span></span>
<span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">comparison</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    ref <span class="op">=</span> <span class="va">ref</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    comp <span class="op">=</span> <span class="va">comparison</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    diff <span class="op">=</span> <span class="op">(</span><span class="va">ref</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">comparison</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">ref</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">diff</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">diff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">''</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'max_depth = '</span>,<span class="va">ok_ids</span><span class="op">$</span><span class="va">max_depth</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'95% error : '</span>, <span class="va">vals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">'% ; '</span>, <span class="va">vals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="st">'%'</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">plots</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpeedVSprecision_files/figure-html/unnamed-chunk-6-1.png" width="100%">
As expected, we can observe a greatest effect when
<code>max_depth</code> is very small. With a <code>max_depth</code> at
8, we have 95% of the relative error comprised between -10% and +15% of
the local density. On average we can see that the range of the relative
error is multiplied by 2.5 each time we decrease the
<code>max_depth</code> by two.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">comparison</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    ref <span class="op">=</span> <span class="va">ref</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    comp <span class="op">=</span> <span class="va">comparison</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    diff <span class="op">=</span> <span class="op">(</span><span class="va">ref</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">comparison</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">ref</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ref</span>, y <span class="op">=</span> <span class="va">diff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'max_depth = 14'</span>,</span>
<span>         y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'max_depth = '</span>,<span class="va">ok_ids</span><span class="op">$</span><span class="va">max_dept</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>         <span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">plots</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpeedVSprecision_files/figure-html/unnamed-chunk-7-1.png" width="100%">
The biggest relative differences are obtained for lixels with low
densities. This is not surprising considering the fact that a small
change in density leads to a great relative error for lixel with small
estimated densities.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lixels</span><span class="op">$</span><span class="va">density_14</span> <span class="op">&lt;-</span> <span class="va">ref</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">id</span> <span class="op">&lt;-</span> <span class="va">ok_ids</span><span class="op">[</span><span class="va">ok_ids</span><span class="op">$</span><span class="va">max_depth</span> <span class="op">==</span> <span class="fl">10</span>,<span class="op">]</span><span class="op">$</span><span class="va">index</span></span>
<span><span class="va">lixels</span><span class="op">$</span><span class="va">density_10</span> <span class="op">&lt;-</span> <span class="va">all_densities</span><span class="op">[[</span><span class="va">id</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">lixels</span><span class="op">$</span><span class="va">error</span> <span class="op">&lt;-</span> <span class="va">lixels</span><span class="op">$</span><span class="va">density_14</span> <span class="op">-</span> <span class="va">lixels</span><span class="op">$</span><span class="va">density_10</span></span>
<span><span class="va">lixels</span><span class="op">$</span><span class="va">rel_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">lixels</span><span class="op">$</span><span class="va">error</span> <span class="op">/</span> <span class="va">lixels</span><span class="op">$</span><span class="va">density_14</span> <span class="op">*</span> <span class="fl">100</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">lixels</span><span class="op">$</span><span class="va">rel_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lixels</span><span class="op">$</span><span class="va">rel_error</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">lixels</span><span class="op">$</span><span class="va">rel_error</span><span class="op">)</span></span>
<span><span class="va">lixels</span><span class="op">$</span><span class="va">rel_error_abs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">lixels</span><span class="op">$</span><span class="va">rel_error</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lixels</span><span class="op">$</span><span class="va">density_14</span> <span class="op">&lt;-</span> <span class="va">lixels</span><span class="op">$</span><span class="va">density_14</span> <span class="op">*</span> <span class="fl">1000</span></span>
<span><span class="va">lixels</span><span class="op">$</span><span class="va">density_10</span> <span class="op">&lt;-</span> <span class="va">lixels</span><span class="op">$</span><span class="va">density_10</span> <span class="op">*</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/classInt/" class="external-link">classInt</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">densities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lixels</span><span class="op">$</span><span class="va">density_14</span>, <span class="va">lixels</span><span class="op">$</span><span class="va">density_10</span><span class="op">)</span></span>
<span><span class="va">color_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/classInt/reference/classIntervals.html" class="external-link">classIntervals</a></span><span class="op">(</span><span class="va">densities</span>, n <span class="op">=</span> <span class="fl">7</span>, style <span class="op">=</span> <span class="st">"kmeans"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">map1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">lixels</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="st">'density_14'</span>, breaks <span class="op">=</span> <span class="va">color_breaks</span><span class="op">$</span><span class="va">brks</span>,</span>
<span>           palette <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span>,  title.col <span class="op">=</span> <span class="st">'density (depth = 14)'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span>, frame <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">map2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">lixels</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="st">'density_10'</span>, breaks <span class="op">=</span> <span class="va">color_breaks</span><span class="op">$</span><span class="va">brks</span>,</span>
<span>           palette <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span>, title.col <span class="op">=</span> <span class="st">'density (depth = 10)'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span>, frame <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">map3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">lixels</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="st">'rel_error'</span>, n <span class="op">=</span> <span class="fl">7</span>, style <span class="op">=</span> <span class="st">'jenks'</span>,</span>
<span>           palette <span class="op">=</span> <span class="st">'RdBu'</span>, title.col <span class="op">=</span> <span class="st">'relative error (%)'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span>, frame <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">map4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">lixels</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="st">'rel_error_abs'</span>, n <span class="op">=</span> <span class="fl">7</span>, style <span class="op">=</span> <span class="st">'jenks'</span>,</span>
<span>           palette <span class="op">=</span> <span class="st">'Reds'</span>, title.col <span class="op">=</span> <span class="st">'absolute relative error (%)'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span>, frame <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_arrange.html" class="external-link">tmap_arrange</a></span><span class="op">(</span><span class="va">map1</span>, <span class="va">map2</span>, <span class="va">map3</span>, <span class="va">map4</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpeedVSprecision_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
<p>The four maps above show that the error tend to not aggregate at
places with high or low densities. This results is important because it
suggests that densities and error are not strongly correlated. However,
we can see some spatial autocorrelation in the errors.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ok_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">params_df</span>, <span class="va">params_df</span><span class="op">$</span><span class="va">max_depth</span> <span class="op">!=</span> <span class="fl">14</span><span class="op">)</span></span>
<span><span class="va">reference</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">params_df</span>, <span class="va">params_df</span><span class="op">$</span><span class="va">max_depth</span> <span class="op">==</span> <span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="va">corr_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ok_ids</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">row</span> <span class="op">&lt;-</span> <span class="va">ok_ids</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  <span class="va">comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">reference</span>, <span class="va">reference</span><span class="op">$</span><span class="va">bw</span> <span class="op">==</span> <span class="va">row</span><span class="op">$</span><span class="va">bw</span><span class="op">)</span></span>
<span>  <span class="va">dens_ref</span> <span class="op">&lt;-</span> <span class="va">all_densities</span><span class="op">[[</span><span class="va">comp</span><span class="op">$</span><span class="va">index</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">dens_approx</span> <span class="op">&lt;-</span> <span class="va">all_densities</span><span class="op">[[</span><span class="va">row</span><span class="op">$</span><span class="va">index</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">error_abs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">dens_ref</span> <span class="op">-</span> <span class="va">dens_approx</span><span class="op">)</span></span>
<span>  <span class="va">error</span> <span class="op">&lt;-</span> <span class="va">dens_ref</span> <span class="op">-</span> <span class="va">dens_approx</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">row</span><span class="op">$</span><span class="va">bw</span>, <span class="va">row</span><span class="op">$</span><span class="va">max_depth</span>,<span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">dens_ref</span>, <span class="va">error</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">dens_ref</span>, <span class="va">error_abs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">corr_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">corr_scores</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">corr_scores</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'bw'</span>, <span class="st">'max_depth'</span>, <span class="st">'corr_error'</span>, <span class="st">'corr_abs_error'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">corr_scores</span><span class="op">$</span><span class="va">max_depth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">corr_scores</span><span class="op">$</span><span class="va">max_depth</span><span class="op">)</span></span>
<span><span class="va">corr_scores</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">corr_scores</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'bw'</span>, <span class="st">'max_depth'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">corr_scores</span><span class="op">$</span><span class="va">variable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">corr_scores</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">corr_scores</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bw</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">max_depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bw</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">max_depth</span>, group <span class="op">=</span> <span class="va">max_depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpeedVSprecision_files/figure-html/unnamed-chunk-9-1.png" width="100%"></p>
<p>The two plots above illustrate the correlations between the reference
density (<code>max_depth = 14</code>) and the error between the
approximated density and the reference density. One displays the
correlation with the natural error and the second with the absolute
error. It is interesting to see that the correlation with the natural
error is much greater for small values of <code>max_depth</code>. A
value of 8 seems to limit the correlation. In other words, selecting
<code>max_depth = 8</code> can limit greatly the risk that the error
caused by simplification is correlated with the real density.</p>
<p>However, the correlations with the absolute errors are all strongly
increasing with the bandwidth. This means that at places with higher
densities, we might expect higher over or underestimation of the
expected density.</p>
</div>
<div class="section level2">
<h2 id="impact-on-bandwidth-selection">Impact on bandwidth selection<a class="anchor" aria-label="anchor" href="#impact-on-bandwidth-selection"></a>
</h2>
<p>Lastly, we want to asses the impact of the <code>max_depth</code>
parameter on the bandwidth selection.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">8</span>,<span class="fl">10</span>,<span class="fl">12</span>,<span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_params2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  max_depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">8</span>,<span class="fl">10</span>,<span class="fl">12</span>,<span class="fl">14</span><span class="op">)</span>,</span>
<span>  index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">df_params2</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_params2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">multisession</a></span><span class="op">(</span>workers<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/progressor.html" class="external-link">progressor</a></span><span class="op">(</span>along <span class="op">=</span> <span class="va">items</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">all_bw_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://future.apply.futureverse.org/reference/future_lapply.html" class="external-link">future_lapply</a></span><span class="op">(</span><span class="va">items</span>, <span class="kw">function</span><span class="op">(</span><span class="va">row</span><span class="op">)</span> <span class="op">{</span></span>
<span>        </span>
<span>        <span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/bw_cv_likelihood_calc.html">bw_cv_likelihood_calc</a></span><span class="op">(</span></span>
<span>            bws <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">200</span>,<span class="fl">1000</span>,<span class="fl">50</span><span class="op">)</span>, </span>
<span>            lines <span class="op">=</span> <span class="va">mtl_network</span>, </span>
<span>            events <span class="op">=</span> <span class="va">bike_accidents</span>, </span>
<span>            w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            kernel_name <span class="op">=</span> <span class="st">"quartic"</span>, </span>
<span>            method <span class="op">=</span> <span class="st">'continuous'</span>,</span>
<span>            adaptive <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            max_depth <span class="op">=</span> <span class="va">row</span><span class="op">$</span><span class="va">max_depth</span>, </span>
<span>            digits <span class="op">=</span> <span class="fl">1</span>, tol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            agg <span class="op">=</span> <span class="fl">10</span>,</span>
<span>            grid_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>            verbose<span class="op">=</span><span class="cn">FALSE</span></span>
<span>          <span class="op">)</span></span>
<span>        </span>
<span>        <span class="fu">p</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"i=%g"</span>, <span class="va">row</span><span class="op">$</span><span class="va">index</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span></span>
<span>      <span class="op">}</span>, future.packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spNetwork"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_bw_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">all_bw_scores</span><span class="op">)</span></span>
<span><span class="va">all_bw_scores</span><span class="op">$</span><span class="va">max_depth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">8</span>,<span class="fl">10</span>,<span class="fl">12</span>,<span class="fl">14</span><span class="op">)</span>, each<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">200</span>,<span class="fl">1000</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_bw_scores</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">all_bw_scores</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'bw'</span>, <span class="st">'max_depth'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">all_bw_scores</span><span class="op">$</span><span class="va">variable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">all_bw_scores</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_bw_scores</span><span class="op">$</span><span class="va">max_depth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">all_bw_scores</span><span class="op">$</span><span class="va">max_depth</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">all_bw_scores</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bw</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">max_depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bw</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">max_depth</span>, group <span class="op">=</span> <span class="va">max_depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpeedVSprecision_files/figure-html/unnamed-chunk-12-1.png" width="100%"></p>
<p>This last results is very interesting. It suggests that the
simplification in density calculation affects only marginally the
bandwidth selection process.</p>
</div>
<div class="section level2">
<h2 id="final-words">Final words<a class="anchor" aria-label="anchor" href="#final-words"></a>
</h2>
<p>Here are the conclusions of this short analysis :</p>
<ol style="list-style-type: decimal">
<li>The parameter <code>max_depth</code> can be used to reduce
significantly the calculation time.</li>
<li>However, it implies calculating a less accurate estimate of the
density value.</li>
<li>The absolute errors are correlated with the local estimates. When
the bandwidth increase, the errors tend to be higher were the densities
are the highest.</li>
<li>The errors do not affect much the bandwidth selection process. It
seems to be safe to use a max_depth of 6 when doing bandwidth
selection.</li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jeremy Gelb.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
