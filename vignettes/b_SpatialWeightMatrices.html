<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Jeremy Gelb" />

<meta name="date" content="2020-07-06" />

<title>Spatial Weight Matrices</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Spatial Weight Matrices</h1>
<h4 class="author">Jeremy Gelb</h4>
<h4 class="date">2020-07-06</h4>


<div id="TOC">
<ul>
<li><a href="#quick-introduction-to-spatial-weight-matrices">Quick introduction to spatial weight matrices</a></li>
<li><a href="#other-features">Other features</a></li>
</ul>
</div>

<p>This vignette is a short introduction to the spatial weight matrices feature of the <strong>spNetwork</strong> package. It will present the main features of the package by using datasets provided with the package.</p>
<div id="quick-introduction-to-spatial-weight-matrices" class="section level1">
<h1>Quick introduction to spatial weight matrices</h1>
<p>A vast number of spatial analysis methods are based on a spatial matrix W<sub>ij</sub> of size <em>n</em> x <em>n</em> with <em>i</em> an observation and <em>j</em> the neighbours of that observation. W<sub>ij</sub> represents the degree of spatial relationship between i and j.</p>
<p>Classicaly one can define :</p>
<ul>
<li>neighbouring matrices (W<sub>ij</sub> = 1 if <em>j</em> is a neighbour of <em>i</em>, 0 otherwise)</li>
<li>distance matrices (W<sub>ij</sub> = the distance between i and j, modified by a function like 1/distance or 1/distance**2)</li>
<li>interraction matrices (W<sub>ij</sub> = the degree of interraction between <em>i</em> and <em>j</em>, the measure of the interraction depends on the subject of the analysis)</li>
</ul>
<p>In R, the classical package to deal with such object is the package <strong>spdep</strong> which defines objects like neighbour lists and spatial weight lists, and offers the possibility to convert such objects into regular matrices.</p>
<p>When one works with data constrained on a network, using euclidean distance to estimate proximity between observation tends to overstimate the real proximity of observations.</p>
<p><strong>spNetwork</strong> offers the possibility to create listw objects based on network distance. Let us give an exemple here: calculating the Moran I for the number of bike accidents recorded on the montreal road network in 2016.</p>
<p>First, we want to split the network into lixels:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">options</span>(<span class="st">&quot;rgdal_show_exportToProj4_warnings&quot;</span>=<span class="st">&quot;none&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(spNetwork)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(maptools)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">library</span>(spdep)</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">data</span>(<span class="st">&quot;mtl_network&quot;</span>)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">data</span>(<span class="st">&quot;bike_accidents&quot;</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co"># set this function to silent in the vignette</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>lixels &lt;-<span class="st"> </span><span class="kw">lixelize_lines</span>(mtl_network,<span class="dv">200</span>,<span class="dt">mindist =</span> <span class="dv">50</span>)</span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#&gt; </span></span>
<span id="cb1-14"><a href="#cb1-14"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</span>
<span id="cb1-16"><a href="#cb1-16"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">1</span>%</span>
<span id="cb1-18"><a href="#cb1-18"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="st">  </span><span class="er">|=</span><span class="st">                                                                     </span><span class="er">|</span><span class="st">   </span><span class="dv">1</span>%</span>
<span id="cb1-20"><a href="#cb1-20"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="st">  </span><span class="er">|=</span><span class="st">                                                                     </span><span class="er">|</span><span class="st">   </span><span class="dv">2</span>%</span>
<span id="cb1-22"><a href="#cb1-22"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="st">  </span><span class="er">|==</span><span class="st">                                                                    </span><span class="er">|</span><span class="st">   </span><span class="dv">2</span>%</span>
<span id="cb1-24"><a href="#cb1-24"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="st">  </span><span class="er">|==</span><span class="st">                                                                    </span><span class="er">|</span><span class="st">   </span><span class="dv">3</span>%</span>
<span id="cb1-26"><a href="#cb1-26"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="st">  </span><span class="er">|==</span><span class="st">                                                                    </span><span class="er">|</span><span class="st">   </span><span class="dv">4</span>%</span>
<span id="cb1-28"><a href="#cb1-28"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="st">  </span><span class="er">|===</span><span class="st">                                                                   </span><span class="er">|</span><span class="st">   </span><span class="dv">4</span>%</span>
<span id="cb1-30"><a href="#cb1-30"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="st">  </span><span class="er">|===</span><span class="st">                                                                   </span><span class="er">|</span><span class="st">   </span><span class="dv">5</span>%</span>
<span id="cb1-32"><a href="#cb1-32"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="st">  </span><span class="er">|====</span><span class="st">                                                                  </span><span class="er">|</span><span class="st">   </span><span class="dv">5</span>%</span>
<span id="cb1-34"><a href="#cb1-34"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="st">  </span><span class="er">|====</span><span class="st">                                                                  </span><span class="er">|</span><span class="st">   </span><span class="dv">6</span>%</span>
<span id="cb1-36"><a href="#cb1-36"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-37"><a href="#cb1-37"></a><span class="st">  </span><span class="er">|=====</span><span class="st">                                                                 </span><span class="er">|</span><span class="st">   </span><span class="dv">6</span>%</span>
<span id="cb1-38"><a href="#cb1-38"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-39"><a href="#cb1-39"></a><span class="st">  </span><span class="er">|=====</span><span class="st">                                                                 </span><span class="er">|</span><span class="st">   </span><span class="dv">7</span>%</span>
<span id="cb1-40"><a href="#cb1-40"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-41"><a href="#cb1-41"></a><span class="st">  </span><span class="er">|=====</span><span class="st">                                                                 </span><span class="er">|</span><span class="st">   </span><span class="dv">8</span>%</span>
<span id="cb1-42"><a href="#cb1-42"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-43"><a href="#cb1-43"></a><span class="st">  </span><span class="er">|======</span><span class="st">                                                                </span><span class="er">|</span><span class="st">   </span><span class="dv">8</span>%</span>
<span id="cb1-44"><a href="#cb1-44"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-45"><a href="#cb1-45"></a><span class="st">  </span><span class="er">|======</span><span class="st">                                                                </span><span class="er">|</span><span class="st">   </span><span class="dv">9</span>%</span>
<span id="cb1-46"><a href="#cb1-46"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="st">  </span><span class="er">|=======</span><span class="st">                                                               </span><span class="er">|</span><span class="st">   </span><span class="dv">9</span>%</span>
<span id="cb1-48"><a href="#cb1-48"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-49"><a href="#cb1-49"></a><span class="st">  </span><span class="er">|=======</span><span class="st">                                                               </span><span class="er">|</span><span class="st">  </span><span class="dv">10</span>%</span>
<span id="cb1-50"><a href="#cb1-50"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-51"><a href="#cb1-51"></a><span class="st">  </span><span class="er">|=======</span><span class="st">                                                               </span><span class="er">|</span><span class="st">  </span><span class="dv">11</span>%</span>
<span id="cb1-52"><a href="#cb1-52"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="st">  </span><span class="er">|========</span><span class="st">                                                              </span><span class="er">|</span><span class="st">  </span><span class="dv">11</span>%</span>
<span id="cb1-54"><a href="#cb1-54"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-55"><a href="#cb1-55"></a><span class="st">  </span><span class="er">|========</span><span class="st">                                                              </span><span class="er">|</span><span class="st">  </span><span class="dv">12</span>%</span>
<span id="cb1-56"><a href="#cb1-56"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-57"><a href="#cb1-57"></a><span class="st">  </span><span class="er">|=========</span><span class="st">                                                             </span><span class="er">|</span><span class="st">  </span><span class="dv">12</span>%</span>
<span id="cb1-58"><a href="#cb1-58"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-59"><a href="#cb1-59"></a><span class="st">  </span><span class="er">|=========</span><span class="st">                                                             </span><span class="er">|</span><span class="st">  </span><span class="dv">13</span>%</span>
<span id="cb1-60"><a href="#cb1-60"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-61"><a href="#cb1-61"></a><span class="st">  </span><span class="er">|=========</span><span class="st">                                                             </span><span class="er">|</span><span class="st">  </span><span class="dv">14</span>%</span>
<span id="cb1-62"><a href="#cb1-62"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-63"><a href="#cb1-63"></a><span class="st">  </span><span class="er">|==========</span><span class="st">                                                            </span><span class="er">|</span><span class="st">  </span><span class="dv">14</span>%</span>
<span id="cb1-64"><a href="#cb1-64"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-65"><a href="#cb1-65"></a><span class="st">  </span><span class="er">|==========</span><span class="st">                                                            </span><span class="er">|</span><span class="st">  </span><span class="dv">15</span>%</span>
<span id="cb1-66"><a href="#cb1-66"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-67"><a href="#cb1-67"></a><span class="st">  </span><span class="er">|===========</span><span class="st">                                                           </span><span class="er">|</span><span class="st">  </span><span class="dv">15</span>%</span>
<span id="cb1-68"><a href="#cb1-68"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-69"><a href="#cb1-69"></a><span class="st">  </span><span class="er">|===========</span><span class="st">                                                           </span><span class="er">|</span><span class="st">  </span><span class="dv">16</span>%</span>
<span id="cb1-70"><a href="#cb1-70"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-71"><a href="#cb1-71"></a><span class="st">  </span><span class="er">|============</span><span class="st">                                                          </span><span class="er">|</span><span class="st">  </span><span class="dv">16</span>%</span>
<span id="cb1-72"><a href="#cb1-72"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-73"><a href="#cb1-73"></a><span class="st">  </span><span class="er">|============</span><span class="st">                                                          </span><span class="er">|</span><span class="st">  </span><span class="dv">17</span>%</span>
<span id="cb1-74"><a href="#cb1-74"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-75"><a href="#cb1-75"></a><span class="st">  </span><span class="er">|============</span><span class="st">                                                          </span><span class="er">|</span><span class="st">  </span><span class="dv">18</span>%</span>
<span id="cb1-76"><a href="#cb1-76"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-77"><a href="#cb1-77"></a><span class="st">  </span><span class="er">|=============</span><span class="st">                                                         </span><span class="er">|</span><span class="st">  </span><span class="dv">18</span>%</span>
<span id="cb1-78"><a href="#cb1-78"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-79"><a href="#cb1-79"></a><span class="st">  </span><span class="er">|=============</span><span class="st">                                                         </span><span class="er">|</span><span class="st">  </span><span class="dv">19</span>%</span>
<span id="cb1-80"><a href="#cb1-80"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-81"><a href="#cb1-81"></a><span class="st">  </span><span class="er">|==============</span><span class="st">                                                        </span><span class="er">|</span><span class="st">  </span><span class="dv">19</span>%</span>
<span id="cb1-82"><a href="#cb1-82"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-83"><a href="#cb1-83"></a><span class="st">  </span><span class="er">|==============</span><span class="st">                                                        </span><span class="er">|</span><span class="st">  </span><span class="dv">20</span>%</span>
<span id="cb1-84"><a href="#cb1-84"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-85"><a href="#cb1-85"></a><span class="st">  </span><span class="er">|==============</span><span class="st">                                                        </span><span class="er">|</span><span class="st">  </span><span class="dv">21</span>%</span>
<span id="cb1-86"><a href="#cb1-86"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-87"><a href="#cb1-87"></a><span class="st">  </span><span class="er">|===============</span><span class="st">                                                       </span><span class="er">|</span><span class="st">  </span><span class="dv">21</span>%</span>
<span id="cb1-88"><a href="#cb1-88"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-89"><a href="#cb1-89"></a><span class="st">  </span><span class="er">|===============</span><span class="st">                                                       </span><span class="er">|</span><span class="st">  </span><span class="dv">22</span>%</span>
<span id="cb1-90"><a href="#cb1-90"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-91"><a href="#cb1-91"></a><span class="st">  </span><span class="er">|================</span><span class="st">                                                      </span><span class="er">|</span><span class="st">  </span><span class="dv">22</span>%</span>
<span id="cb1-92"><a href="#cb1-92"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-93"><a href="#cb1-93"></a><span class="st">  </span><span class="er">|================</span><span class="st">                                                      </span><span class="er">|</span><span class="st">  </span><span class="dv">23</span>%</span>
<span id="cb1-94"><a href="#cb1-94"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-95"><a href="#cb1-95"></a><span class="st">  </span><span class="er">|================</span><span class="st">                                                      </span><span class="er">|</span><span class="st">  </span><span class="dv">24</span>%</span>
<span id="cb1-96"><a href="#cb1-96"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-97"><a href="#cb1-97"></a><span class="st">  </span><span class="er">|=================</span><span class="st">                                                     </span><span class="er">|</span><span class="st">  </span><span class="dv">24</span>%</span>
<span id="cb1-98"><a href="#cb1-98"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-99"><a href="#cb1-99"></a><span class="st">  </span><span class="er">|=================</span><span class="st">                                                     </span><span class="er">|</span><span class="st">  </span><span class="dv">25</span>%</span>
<span id="cb1-100"><a href="#cb1-100"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-101"><a href="#cb1-101"></a><span class="st">  </span><span class="er">|==================</span><span class="st">                                                    </span><span class="er">|</span><span class="st">  </span><span class="dv">25</span>%</span>
<span id="cb1-102"><a href="#cb1-102"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-103"><a href="#cb1-103"></a><span class="st">  </span><span class="er">|==================</span><span class="st">                                                    </span><span class="er">|</span><span class="st">  </span><span class="dv">26</span>%</span>
<span id="cb1-104"><a href="#cb1-104"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-105"><a href="#cb1-105"></a><span class="st">  </span><span class="er">|===================</span><span class="st">                                                   </span><span class="er">|</span><span class="st">  </span><span class="dv">26</span>%</span>
<span id="cb1-106"><a href="#cb1-106"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-107"><a href="#cb1-107"></a><span class="st">  </span><span class="er">|===================</span><span class="st">                                                   </span><span class="er">|</span><span class="st">  </span><span class="dv">27</span>%</span>
<span id="cb1-108"><a href="#cb1-108"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-109"><a href="#cb1-109"></a><span class="st">  </span><span class="er">|===================</span><span class="st">                                                   </span><span class="er">|</span><span class="st">  </span><span class="dv">28</span>%</span>
<span id="cb1-110"><a href="#cb1-110"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-111"><a href="#cb1-111"></a><span class="st">  </span><span class="er">|====================</span><span class="st">                                                  </span><span class="er">|</span><span class="st">  </span><span class="dv">28</span>%</span>
<span id="cb1-112"><a href="#cb1-112"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-113"><a href="#cb1-113"></a><span class="st">  </span><span class="er">|====================</span><span class="st">                                                  </span><span class="er">|</span><span class="st">  </span><span class="dv">29</span>%</span>
<span id="cb1-114"><a href="#cb1-114"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-115"><a href="#cb1-115"></a><span class="st">  </span><span class="er">|=====================</span><span class="st">                                                 </span><span class="er">|</span><span class="st">  </span><span class="dv">29</span>%</span>
<span id="cb1-116"><a href="#cb1-116"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-117"><a href="#cb1-117"></a><span class="st">  </span><span class="er">|=====================</span><span class="st">                                                 </span><span class="er">|</span><span class="st">  </span><span class="dv">30</span>%</span>
<span id="cb1-118"><a href="#cb1-118"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-119"><a href="#cb1-119"></a><span class="st">  </span><span class="er">|=====================</span><span class="st">                                                 </span><span class="er">|</span><span class="st">  </span><span class="dv">31</span>%</span>
<span id="cb1-120"><a href="#cb1-120"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-121"><a href="#cb1-121"></a><span class="st">  </span><span class="er">|======================</span><span class="st">                                                </span><span class="er">|</span><span class="st">  </span><span class="dv">31</span>%</span>
<span id="cb1-122"><a href="#cb1-122"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-123"><a href="#cb1-123"></a><span class="st">  </span><span class="er">|======================</span><span class="st">                                                </span><span class="er">|</span><span class="st">  </span><span class="dv">32</span>%</span>
<span id="cb1-124"><a href="#cb1-124"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-125"><a href="#cb1-125"></a><span class="st">  </span><span class="er">|=======================</span><span class="st">                                               </span><span class="er">|</span><span class="st">  </span><span class="dv">32</span>%</span>
<span id="cb1-126"><a href="#cb1-126"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-127"><a href="#cb1-127"></a><span class="st">  </span><span class="er">|=======================</span><span class="st">                                               </span><span class="er">|</span><span class="st">  </span><span class="dv">33</span>%</span>
<span id="cb1-128"><a href="#cb1-128"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-129"><a href="#cb1-129"></a><span class="st">  </span><span class="er">|=======================</span><span class="st">                                               </span><span class="er">|</span><span class="st">  </span><span class="dv">34</span>%</span>
<span id="cb1-130"><a href="#cb1-130"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-131"><a href="#cb1-131"></a><span class="st">  </span><span class="er">|========================</span><span class="st">                                              </span><span class="er">|</span><span class="st">  </span><span class="dv">34</span>%</span>
<span id="cb1-132"><a href="#cb1-132"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-133"><a href="#cb1-133"></a><span class="st">  </span><span class="er">|========================</span><span class="st">                                              </span><span class="er">|</span><span class="st">  </span><span class="dv">35</span>%</span>
<span id="cb1-134"><a href="#cb1-134"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-135"><a href="#cb1-135"></a><span class="st">  </span><span class="er">|=========================</span><span class="st">                                             </span><span class="er">|</span><span class="st">  </span><span class="dv">35</span>%</span>
<span id="cb1-136"><a href="#cb1-136"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-137"><a href="#cb1-137"></a><span class="st">  </span><span class="er">|=========================</span><span class="st">                                             </span><span class="er">|</span><span class="st">  </span><span class="dv">36</span>%</span>
<span id="cb1-138"><a href="#cb1-138"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-139"><a href="#cb1-139"></a><span class="st">  </span><span class="er">|==========================</span><span class="st">                                            </span><span class="er">|</span><span class="st">  </span><span class="dv">36</span>%</span>
<span id="cb1-140"><a href="#cb1-140"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-141"><a href="#cb1-141"></a><span class="st">  </span><span class="er">|==========================</span><span class="st">                                            </span><span class="er">|</span><span class="st">  </span><span class="dv">37</span>%</span>
<span id="cb1-142"><a href="#cb1-142"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-143"><a href="#cb1-143"></a><span class="st">  </span><span class="er">|==========================</span><span class="st">                                            </span><span class="er">|</span><span class="st">  </span><span class="dv">38</span>%</span>
<span id="cb1-144"><a href="#cb1-144"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-145"><a href="#cb1-145"></a><span class="st">  </span><span class="er">|===========================</span><span class="st">                                           </span><span class="er">|</span><span class="st">  </span><span class="dv">38</span>%</span>
<span id="cb1-146"><a href="#cb1-146"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-147"><a href="#cb1-147"></a><span class="st">  </span><span class="er">|===========================</span><span class="st">                                           </span><span class="er">|</span><span class="st">  </span><span class="dv">39</span>%</span>
<span id="cb1-148"><a href="#cb1-148"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-149"><a href="#cb1-149"></a><span class="st">  </span><span class="er">|============================</span><span class="st">                                          </span><span class="er">|</span><span class="st">  </span><span class="dv">39</span>%</span>
<span id="cb1-150"><a href="#cb1-150"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-151"><a href="#cb1-151"></a><span class="st">  </span><span class="er">|============================</span><span class="st">                                          </span><span class="er">|</span><span class="st">  </span><span class="dv">40</span>%</span>
<span id="cb1-152"><a href="#cb1-152"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-153"><a href="#cb1-153"></a><span class="st">  </span><span class="er">|============================</span><span class="st">                                          </span><span class="er">|</span><span class="st">  </span><span class="dv">41</span>%</span>
<span id="cb1-154"><a href="#cb1-154"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-155"><a href="#cb1-155"></a><span class="st">  </span><span class="er">|=============================</span><span class="st">                                         </span><span class="er">|</span><span class="st">  </span><span class="dv">41</span>%</span>
<span id="cb1-156"><a href="#cb1-156"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-157"><a href="#cb1-157"></a><span class="st">  </span><span class="er">|=============================</span><span class="st">                                         </span><span class="er">|</span><span class="st">  </span><span class="dv">42</span>%</span>
<span id="cb1-158"><a href="#cb1-158"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-159"><a href="#cb1-159"></a><span class="st">  </span><span class="er">|==============================</span><span class="st">                                        </span><span class="er">|</span><span class="st">  </span><span class="dv">42</span>%</span>
<span id="cb1-160"><a href="#cb1-160"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-161"><a href="#cb1-161"></a><span class="st">  </span><span class="er">|==============================</span><span class="st">                                        </span><span class="er">|</span><span class="st">  </span><span class="dv">43</span>%</span>
<span id="cb1-162"><a href="#cb1-162"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-163"><a href="#cb1-163"></a><span class="st">  </span><span class="er">|==============================</span><span class="st">                                        </span><span class="er">|</span><span class="st">  </span><span class="dv">44</span>%</span>
<span id="cb1-164"><a href="#cb1-164"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-165"><a href="#cb1-165"></a><span class="st">  </span><span class="er">|===============================</span><span class="st">                                       </span><span class="er">|</span><span class="st">  </span><span class="dv">44</span>%</span>
<span id="cb1-166"><a href="#cb1-166"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-167"><a href="#cb1-167"></a><span class="st">  </span><span class="er">|===============================</span><span class="st">                                       </span><span class="er">|</span><span class="st">  </span><span class="dv">45</span>%</span>
<span id="cb1-168"><a href="#cb1-168"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-169"><a href="#cb1-169"></a><span class="st">  </span><span class="er">|================================</span><span class="st">                                      </span><span class="er">|</span><span class="st">  </span><span class="dv">45</span>%</span>
<span id="cb1-170"><a href="#cb1-170"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-171"><a href="#cb1-171"></a><span class="st">  </span><span class="er">|================================</span><span class="st">                                      </span><span class="er">|</span><span class="st">  </span><span class="dv">46</span>%</span>
<span id="cb1-172"><a href="#cb1-172"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-173"><a href="#cb1-173"></a><span class="st">  </span><span class="er">|=================================</span><span class="st">                                     </span><span class="er">|</span><span class="st">  </span><span class="dv">46</span>%</span>
<span id="cb1-174"><a href="#cb1-174"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-175"><a href="#cb1-175"></a><span class="st">  </span><span class="er">|=================================</span><span class="st">                                     </span><span class="er">|</span><span class="st">  </span><span class="dv">47</span>%</span>
<span id="cb1-176"><a href="#cb1-176"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-177"><a href="#cb1-177"></a><span class="st">  </span><span class="er">|=================================</span><span class="st">                                     </span><span class="er">|</span><span class="st">  </span><span class="dv">48</span>%</span>
<span id="cb1-178"><a href="#cb1-178"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-179"><a href="#cb1-179"></a><span class="st">  </span><span class="er">|==================================</span><span class="st">                                    </span><span class="er">|</span><span class="st">  </span><span class="dv">48</span>%</span>
<span id="cb1-180"><a href="#cb1-180"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-181"><a href="#cb1-181"></a><span class="st">  </span><span class="er">|==================================</span><span class="st">                                    </span><span class="er">|</span><span class="st">  </span><span class="dv">49</span>%</span>
<span id="cb1-182"><a href="#cb1-182"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-183"><a href="#cb1-183"></a><span class="st">  </span><span class="er">|===================================</span><span class="st">                                   </span><span class="er">|</span><span class="st">  </span><span class="dv">49</span>%</span>
<span id="cb1-184"><a href="#cb1-184"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-185"><a href="#cb1-185"></a><span class="st">  </span><span class="er">|===================================</span><span class="st">                                   </span><span class="er">|</span><span class="st">  </span><span class="dv">50</span>%</span>
<span id="cb1-186"><a href="#cb1-186"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-187"><a href="#cb1-187"></a><span class="st">  </span><span class="er">|===================================</span><span class="st">                                   </span><span class="er">|</span><span class="st">  </span><span class="dv">51</span>%</span>
<span id="cb1-188"><a href="#cb1-188"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-189"><a href="#cb1-189"></a><span class="st">  </span><span class="er">|====================================</span><span class="st">                                  </span><span class="er">|</span><span class="st">  </span><span class="dv">51</span>%</span>
<span id="cb1-190"><a href="#cb1-190"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-191"><a href="#cb1-191"></a><span class="st">  </span><span class="er">|====================================</span><span class="st">                                  </span><span class="er">|</span><span class="st">  </span><span class="dv">52</span>%</span>
<span id="cb1-192"><a href="#cb1-192"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-193"><a href="#cb1-193"></a><span class="st">  </span><span class="er">|=====================================</span><span class="st">                                 </span><span class="er">|</span><span class="st">  </span><span class="dv">52</span>%</span>
<span id="cb1-194"><a href="#cb1-194"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-195"><a href="#cb1-195"></a><span class="st">  </span><span class="er">|=====================================</span><span class="st">                                 </span><span class="er">|</span><span class="st">  </span><span class="dv">53</span>%</span>
<span id="cb1-196"><a href="#cb1-196"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-197"><a href="#cb1-197"></a><span class="st">  </span><span class="er">|=====================================</span><span class="st">                                 </span><span class="er">|</span><span class="st">  </span><span class="dv">54</span>%</span>
<span id="cb1-198"><a href="#cb1-198"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-199"><a href="#cb1-199"></a><span class="st">  </span><span class="er">|======================================</span><span class="st">                                </span><span class="er">|</span><span class="st">  </span><span class="dv">54</span>%</span>
<span id="cb1-200"><a href="#cb1-200"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-201"><a href="#cb1-201"></a><span class="st">  </span><span class="er">|======================================</span><span class="st">                                </span><span class="er">|</span><span class="st">  </span><span class="dv">55</span>%</span>
<span id="cb1-202"><a href="#cb1-202"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-203"><a href="#cb1-203"></a><span class="st">  </span><span class="er">|=======================================</span><span class="st">                               </span><span class="er">|</span><span class="st">  </span><span class="dv">55</span>%</span>
<span id="cb1-204"><a href="#cb1-204"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-205"><a href="#cb1-205"></a><span class="st">  </span><span class="er">|=======================================</span><span class="st">                               </span><span class="er">|</span><span class="st">  </span><span class="dv">56</span>%</span>
<span id="cb1-206"><a href="#cb1-206"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-207"><a href="#cb1-207"></a><span class="st">  </span><span class="er">|========================================</span><span class="st">                              </span><span class="er">|</span><span class="st">  </span><span class="dv">56</span>%</span>
<span id="cb1-208"><a href="#cb1-208"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-209"><a href="#cb1-209"></a><span class="st">  </span><span class="er">|========================================</span><span class="st">                              </span><span class="er">|</span><span class="st">  </span><span class="dv">57</span>%</span>
<span id="cb1-210"><a href="#cb1-210"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-211"><a href="#cb1-211"></a><span class="st">  </span><span class="er">|========================================</span><span class="st">                              </span><span class="er">|</span><span class="st">  </span><span class="dv">58</span>%</span>
<span id="cb1-212"><a href="#cb1-212"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-213"><a href="#cb1-213"></a><span class="st">  </span><span class="er">|=========================================</span><span class="st">                             </span><span class="er">|</span><span class="st">  </span><span class="dv">58</span>%</span>
<span id="cb1-214"><a href="#cb1-214"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-215"><a href="#cb1-215"></a><span class="st">  </span><span class="er">|=========================================</span><span class="st">                             </span><span class="er">|</span><span class="st">  </span><span class="dv">59</span>%</span>
<span id="cb1-216"><a href="#cb1-216"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-217"><a href="#cb1-217"></a><span class="st">  </span><span class="er">|==========================================</span><span class="st">                            </span><span class="er">|</span><span class="st">  </span><span class="dv">59</span>%</span>
<span id="cb1-218"><a href="#cb1-218"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-219"><a href="#cb1-219"></a><span class="st">  </span><span class="er">|==========================================</span><span class="st">                            </span><span class="er">|</span><span class="st">  </span><span class="dv">60</span>%</span>
<span id="cb1-220"><a href="#cb1-220"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-221"><a href="#cb1-221"></a><span class="st">  </span><span class="er">|==========================================</span><span class="st">                            </span><span class="er">|</span><span class="st">  </span><span class="dv">61</span>%</span>
<span id="cb1-222"><a href="#cb1-222"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-223"><a href="#cb1-223"></a><span class="st">  </span><span class="er">|===========================================</span><span class="st">                           </span><span class="er">|</span><span class="st">  </span><span class="dv">61</span>%</span>
<span id="cb1-224"><a href="#cb1-224"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-225"><a href="#cb1-225"></a><span class="st">  </span><span class="er">|===========================================</span><span class="st">                           </span><span class="er">|</span><span class="st">  </span><span class="dv">62</span>%</span>
<span id="cb1-226"><a href="#cb1-226"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-227"><a href="#cb1-227"></a><span class="st">  </span><span class="er">|============================================</span><span class="st">                          </span><span class="er">|</span><span class="st">  </span><span class="dv">62</span>%</span>
<span id="cb1-228"><a href="#cb1-228"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-229"><a href="#cb1-229"></a><span class="st">  </span><span class="er">|============================================</span><span class="st">                          </span><span class="er">|</span><span class="st">  </span><span class="dv">63</span>%</span>
<span id="cb1-230"><a href="#cb1-230"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-231"><a href="#cb1-231"></a><span class="st">  </span><span class="er">|============================================</span><span class="st">                          </span><span class="er">|</span><span class="st">  </span><span class="dv">64</span>%</span>
<span id="cb1-232"><a href="#cb1-232"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-233"><a href="#cb1-233"></a><span class="st">  </span><span class="er">|=============================================</span><span class="st">                         </span><span class="er">|</span><span class="st">  </span><span class="dv">64</span>%</span>
<span id="cb1-234"><a href="#cb1-234"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-235"><a href="#cb1-235"></a><span class="st">  </span><span class="er">|=============================================</span><span class="st">                         </span><span class="er">|</span><span class="st">  </span><span class="dv">65</span>%</span>
<span id="cb1-236"><a href="#cb1-236"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-237"><a href="#cb1-237"></a><span class="st">  </span><span class="er">|==============================================</span><span class="st">                        </span><span class="er">|</span><span class="st">  </span><span class="dv">65</span>%</span>
<span id="cb1-238"><a href="#cb1-238"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-239"><a href="#cb1-239"></a><span class="st">  </span><span class="er">|==============================================</span><span class="st">                        </span><span class="er">|</span><span class="st">  </span><span class="dv">66</span>%</span>
<span id="cb1-240"><a href="#cb1-240"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-241"><a href="#cb1-241"></a><span class="st">  </span><span class="er">|===============================================</span><span class="st">                       </span><span class="er">|</span><span class="st">  </span><span class="dv">66</span>%</span>
<span id="cb1-242"><a href="#cb1-242"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-243"><a href="#cb1-243"></a><span class="st">  </span><span class="er">|===============================================</span><span class="st">                       </span><span class="er">|</span><span class="st">  </span><span class="dv">67</span>%</span>
<span id="cb1-244"><a href="#cb1-244"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-245"><a href="#cb1-245"></a><span class="st">  </span><span class="er">|===============================================</span><span class="st">                       </span><span class="er">|</span><span class="st">  </span><span class="dv">68</span>%</span>
<span id="cb1-246"><a href="#cb1-246"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-247"><a href="#cb1-247"></a><span class="st">  </span><span class="er">|================================================</span><span class="st">                      </span><span class="er">|</span><span class="st">  </span><span class="dv">68</span>%</span>
<span id="cb1-248"><a href="#cb1-248"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-249"><a href="#cb1-249"></a><span class="st">  </span><span class="er">|================================================</span><span class="st">                      </span><span class="er">|</span><span class="st">  </span><span class="dv">69</span>%</span>
<span id="cb1-250"><a href="#cb1-250"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-251"><a href="#cb1-251"></a><span class="st">  </span><span class="er">|=================================================</span><span class="st">                     </span><span class="er">|</span><span class="st">  </span><span class="dv">69</span>%</span>
<span id="cb1-252"><a href="#cb1-252"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-253"><a href="#cb1-253"></a><span class="st">  </span><span class="er">|=================================================</span><span class="st">                     </span><span class="er">|</span><span class="st">  </span><span class="dv">70</span>%</span>
<span id="cb1-254"><a href="#cb1-254"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-255"><a href="#cb1-255"></a><span class="st">  </span><span class="er">|=================================================</span><span class="st">                     </span><span class="er">|</span><span class="st">  </span><span class="dv">71</span>%</span>
<span id="cb1-256"><a href="#cb1-256"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-257"><a href="#cb1-257"></a><span class="st">  </span><span class="er">|==================================================</span><span class="st">                    </span><span class="er">|</span><span class="st">  </span><span class="dv">71</span>%</span>
<span id="cb1-258"><a href="#cb1-258"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-259"><a href="#cb1-259"></a><span class="st">  </span><span class="er">|==================================================</span><span class="st">                    </span><span class="er">|</span><span class="st">  </span><span class="dv">72</span>%</span>
<span id="cb1-260"><a href="#cb1-260"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-261"><a href="#cb1-261"></a><span class="st">  </span><span class="er">|===================================================</span><span class="st">                   </span><span class="er">|</span><span class="st">  </span><span class="dv">72</span>%</span>
<span id="cb1-262"><a href="#cb1-262"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-263"><a href="#cb1-263"></a><span class="st">  </span><span class="er">|===================================================</span><span class="st">                   </span><span class="er">|</span><span class="st">  </span><span class="dv">73</span>%</span>
<span id="cb1-264"><a href="#cb1-264"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-265"><a href="#cb1-265"></a><span class="st">  </span><span class="er">|===================================================</span><span class="st">                   </span><span class="er">|</span><span class="st">  </span><span class="dv">74</span>%</span>
<span id="cb1-266"><a href="#cb1-266"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-267"><a href="#cb1-267"></a><span class="st">  </span><span class="er">|====================================================</span><span class="st">                  </span><span class="er">|</span><span class="st">  </span><span class="dv">74</span>%</span>
<span id="cb1-268"><a href="#cb1-268"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-269"><a href="#cb1-269"></a><span class="st">  </span><span class="er">|====================================================</span><span class="st">                  </span><span class="er">|</span><span class="st">  </span><span class="dv">75</span>%</span>
<span id="cb1-270"><a href="#cb1-270"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-271"><a href="#cb1-271"></a><span class="st">  </span><span class="er">|=====================================================</span><span class="st">                 </span><span class="er">|</span><span class="st">  </span><span class="dv">75</span>%</span>
<span id="cb1-272"><a href="#cb1-272"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-273"><a href="#cb1-273"></a><span class="st">  </span><span class="er">|=====================================================</span><span class="st">                 </span><span class="er">|</span><span class="st">  </span><span class="dv">76</span>%</span>
<span id="cb1-274"><a href="#cb1-274"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-275"><a href="#cb1-275"></a><span class="st">  </span><span class="er">|======================================================</span><span class="st">                </span><span class="er">|</span><span class="st">  </span><span class="dv">76</span>%</span>
<span id="cb1-276"><a href="#cb1-276"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-277"><a href="#cb1-277"></a><span class="st">  </span><span class="er">|======================================================</span><span class="st">                </span><span class="er">|</span><span class="st">  </span><span class="dv">77</span>%</span>
<span id="cb1-278"><a href="#cb1-278"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-279"><a href="#cb1-279"></a><span class="st">  </span><span class="er">|======================================================</span><span class="st">                </span><span class="er">|</span><span class="st">  </span><span class="dv">78</span>%</span>
<span id="cb1-280"><a href="#cb1-280"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-281"><a href="#cb1-281"></a><span class="st">  </span><span class="er">|=======================================================</span><span class="st">               </span><span class="er">|</span><span class="st">  </span><span class="dv">78</span>%</span>
<span id="cb1-282"><a href="#cb1-282"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-283"><a href="#cb1-283"></a><span class="st">  </span><span class="er">|=======================================================</span><span class="st">               </span><span class="er">|</span><span class="st">  </span><span class="dv">79</span>%</span>
<span id="cb1-284"><a href="#cb1-284"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-285"><a href="#cb1-285"></a><span class="st">  </span><span class="er">|========================================================</span><span class="st">              </span><span class="er">|</span><span class="st">  </span><span class="dv">79</span>%</span>
<span id="cb1-286"><a href="#cb1-286"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-287"><a href="#cb1-287"></a><span class="st">  </span><span class="er">|========================================================</span><span class="st">              </span><span class="er">|</span><span class="st">  </span><span class="dv">80</span>%</span>
<span id="cb1-288"><a href="#cb1-288"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-289"><a href="#cb1-289"></a><span class="st">  </span><span class="er">|========================================================</span><span class="st">              </span><span class="er">|</span><span class="st">  </span><span class="dv">81</span>%</span>
<span id="cb1-290"><a href="#cb1-290"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-291"><a href="#cb1-291"></a><span class="st">  </span><span class="er">|=========================================================</span><span class="st">             </span><span class="er">|</span><span class="st">  </span><span class="dv">81</span>%</span>
<span id="cb1-292"><a href="#cb1-292"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-293"><a href="#cb1-293"></a><span class="st">  </span><span class="er">|=========================================================</span><span class="st">             </span><span class="er">|</span><span class="st">  </span><span class="dv">82</span>%</span>
<span id="cb1-294"><a href="#cb1-294"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-295"><a href="#cb1-295"></a><span class="st">  </span><span class="er">|==========================================================</span><span class="st">            </span><span class="er">|</span><span class="st">  </span><span class="dv">82</span>%</span>
<span id="cb1-296"><a href="#cb1-296"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-297"><a href="#cb1-297"></a><span class="st">  </span><span class="er">|==========================================================</span><span class="st">            </span><span class="er">|</span><span class="st">  </span><span class="dv">83</span>%</span>
<span id="cb1-298"><a href="#cb1-298"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-299"><a href="#cb1-299"></a><span class="st">  </span><span class="er">|==========================================================</span><span class="st">            </span><span class="er">|</span><span class="st">  </span><span class="dv">84</span>%</span>
<span id="cb1-300"><a href="#cb1-300"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-301"><a href="#cb1-301"></a><span class="st">  </span><span class="er">|===========================================================</span><span class="st">           </span><span class="er">|</span><span class="st">  </span><span class="dv">84</span>%</span>
<span id="cb1-302"><a href="#cb1-302"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-303"><a href="#cb1-303"></a><span class="st">  </span><span class="er">|===========================================================</span><span class="st">           </span><span class="er">|</span><span class="st">  </span><span class="dv">85</span>%</span>
<span id="cb1-304"><a href="#cb1-304"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-305"><a href="#cb1-305"></a><span class="st">  </span><span class="er">|============================================================</span><span class="st">          </span><span class="er">|</span><span class="st">  </span><span class="dv">85</span>%</span>
<span id="cb1-306"><a href="#cb1-306"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-307"><a href="#cb1-307"></a><span class="st">  </span><span class="er">|============================================================</span><span class="st">          </span><span class="er">|</span><span class="st">  </span><span class="dv">86</span>%</span>
<span id="cb1-308"><a href="#cb1-308"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-309"><a href="#cb1-309"></a><span class="st">  </span><span class="er">|=============================================================</span><span class="st">         </span><span class="er">|</span><span class="st">  </span><span class="dv">86</span>%</span>
<span id="cb1-310"><a href="#cb1-310"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-311"><a href="#cb1-311"></a><span class="st">  </span><span class="er">|=============================================================</span><span class="st">         </span><span class="er">|</span><span class="st">  </span><span class="dv">87</span>%</span>
<span id="cb1-312"><a href="#cb1-312"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-313"><a href="#cb1-313"></a><span class="st">  </span><span class="er">|=============================================================</span><span class="st">         </span><span class="er">|</span><span class="st">  </span><span class="dv">88</span>%</span>
<span id="cb1-314"><a href="#cb1-314"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-315"><a href="#cb1-315"></a><span class="st">  </span><span class="er">|==============================================================</span><span class="st">        </span><span class="er">|</span><span class="st">  </span><span class="dv">88</span>%</span>
<span id="cb1-316"><a href="#cb1-316"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-317"><a href="#cb1-317"></a><span class="st">  </span><span class="er">|==============================================================</span><span class="st">        </span><span class="er">|</span><span class="st">  </span><span class="dv">89</span>%</span>
<span id="cb1-318"><a href="#cb1-318"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-319"><a href="#cb1-319"></a><span class="st">  </span><span class="er">|===============================================================</span><span class="st">       </span><span class="er">|</span><span class="st">  </span><span class="dv">89</span>%</span>
<span id="cb1-320"><a href="#cb1-320"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-321"><a href="#cb1-321"></a><span class="st">  </span><span class="er">|===============================================================</span><span class="st">       </span><span class="er">|</span><span class="st">  </span><span class="dv">90</span>%</span>
<span id="cb1-322"><a href="#cb1-322"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-323"><a href="#cb1-323"></a><span class="st">  </span><span class="er">|===============================================================</span><span class="st">       </span><span class="er">|</span><span class="st">  </span><span class="dv">91</span>%</span>
<span id="cb1-324"><a href="#cb1-324"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-325"><a href="#cb1-325"></a><span class="st">  </span><span class="er">|================================================================</span><span class="st">      </span><span class="er">|</span><span class="st">  </span><span class="dv">91</span>%</span>
<span id="cb1-326"><a href="#cb1-326"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-327"><a href="#cb1-327"></a><span class="st">  </span><span class="er">|================================================================</span><span class="st">      </span><span class="er">|</span><span class="st">  </span><span class="dv">92</span>%</span>
<span id="cb1-328"><a href="#cb1-328"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-329"><a href="#cb1-329"></a><span class="st">  </span><span class="er">|=================================================================</span><span class="st">     </span><span class="er">|</span><span class="st">  </span><span class="dv">92</span>%</span>
<span id="cb1-330"><a href="#cb1-330"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-331"><a href="#cb1-331"></a><span class="st">  </span><span class="er">|=================================================================</span><span class="st">     </span><span class="er">|</span><span class="st">  </span><span class="dv">93</span>%</span>
<span id="cb1-332"><a href="#cb1-332"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-333"><a href="#cb1-333"></a><span class="st">  </span><span class="er">|=================================================================</span><span class="st">     </span><span class="er">|</span><span class="st">  </span><span class="dv">94</span>%</span>
<span id="cb1-334"><a href="#cb1-334"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-335"><a href="#cb1-335"></a><span class="st">  </span><span class="er">|==================================================================</span><span class="st">    </span><span class="er">|</span><span class="st">  </span><span class="dv">94</span>%</span>
<span id="cb1-336"><a href="#cb1-336"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-337"><a href="#cb1-337"></a><span class="st">  </span><span class="er">|==================================================================</span><span class="st">    </span><span class="er">|</span><span class="st">  </span><span class="dv">95</span>%</span>
<span id="cb1-338"><a href="#cb1-338"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-339"><a href="#cb1-339"></a><span class="st">  </span><span class="er">|===================================================================</span><span class="st">   </span><span class="er">|</span><span class="st">  </span><span class="dv">95</span>%</span>
<span id="cb1-340"><a href="#cb1-340"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-341"><a href="#cb1-341"></a><span class="st">  </span><span class="er">|===================================================================</span><span class="st">   </span><span class="er">|</span><span class="st">  </span><span class="dv">96</span>%</span>
<span id="cb1-342"><a href="#cb1-342"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-343"><a href="#cb1-343"></a><span class="st">  </span><span class="er">|====================================================================</span><span class="st">  </span><span class="er">|</span><span class="st">  </span><span class="dv">96</span>%</span>
<span id="cb1-344"><a href="#cb1-344"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-345"><a href="#cb1-345"></a><span class="st">  </span><span class="er">|====================================================================</span><span class="st">  </span><span class="er">|</span><span class="st">  </span><span class="dv">97</span>%</span>
<span id="cb1-346"><a href="#cb1-346"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-347"><a href="#cb1-347"></a><span class="st">  </span><span class="er">|====================================================================</span><span class="st">  </span><span class="er">|</span><span class="st">  </span><span class="dv">98</span>%</span>
<span id="cb1-348"><a href="#cb1-348"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-349"><a href="#cb1-349"></a><span class="st">  </span><span class="er">|=====================================================================</span><span class="st"> </span><span class="er">|</span><span class="st">  </span><span class="dv">98</span>%</span>
<span id="cb1-350"><a href="#cb1-350"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-351"><a href="#cb1-351"></a><span class="st">  </span><span class="er">|=====================================================================</span><span class="st"> </span><span class="er">|</span><span class="st">  </span><span class="dv">99</span>%</span>
<span id="cb1-352"><a href="#cb1-352"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-353"><a href="#cb1-353"></a><span class="st">  </span><span class="er">|======================================================================|</span><span class="st">  </span><span class="dv">99</span>%</span>
<span id="cb1-354"><a href="#cb1-354"></a>  <span class="op">|</span><span class="st">                                                                            </span></span>
<span id="cb1-355"><a href="#cb1-355"></a><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</span></code></pre></div>
<p>then we want to calculate for each lixel the number of event on that lixel</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># defining and oid for the lines</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>lixels<span class="op">$</span>oid &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(lixels)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a>snapped_acc &lt;-<span class="st"> </span><span class="kw">snapPointsToLines</span>(bike_accidents,lixels, <span class="dt">idField =</span><span class="st">&quot;oid&quot;</span>)</span>
<span id="cb2-6"><a href="#cb2-6"></a>counts &lt;-<span class="st"> </span><span class="kw">table</span>(snapped_acc<span class="op">$</span>nearest_line_id)</span>
<span id="cb2-7"><a href="#cb2-7"></a>counts_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="st">&quot;oid&quot;</span> =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(<span class="kw">names</span>(counts))),</span>
<span id="cb2-8"><a href="#cb2-8"></a>                        <span class="st">&quot;count&quot;</span> =<span class="st"> </span><span class="kw">as.numeric</span>(counts))</span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a>lixels<span class="op">$</span>nbAccident &lt;-<span class="st"> </span><span class="kw">left_join</span>(lixels<span class="op">@</span>data,counts_df, <span class="dt">by=</span><span class="st">&quot;oid&quot;</span>)<span class="op">$</span>count</span>
<span id="cb2-11"><a href="#cb2-11"></a>lixels<span class="op">$</span>nbAccident &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(lixels<span class="op">$</span>nbAccident),<span class="dv">0</span>,lixels<span class="op">$</span>nbAccident)</span></code></pre></div>
<p>We will use here the function <em>network_listw</em>. The distances can be calculated from the centroids of the lixels, from the ends of the lixels or from evenly spaced points on the lixels. We use here the <em>ends</em> method.</p>
<p>Let us consider that above 300 meters two segments are not neighbours anymore, and convert the distances between the observations into spatial weights with the inverse of the squared distance</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>netlistw &lt;-<span class="st"> </span><span class="kw">network_listw</span>(lixels,mtl_network,</span>
<span id="cb3-2"><a href="#cb3-2"></a>                           <span class="dt">method =</span> <span class="st">&quot;ends&quot;</span>,</span>
<span id="cb3-3"><a href="#cb3-3"></a>                           <span class="dt">mindist =</span> <span class="dv">10</span>,</span>
<span id="cb3-4"><a href="#cb3-4"></a>                           <span class="dt">maxdistance =</span> <span class="dv">300</span>,</span>
<span id="cb3-5"><a href="#cb3-5"></a>                           <span class="dt">dist_func =</span> <span class="st">&quot;squared inverse&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6"></a>                           <span class="dt">line_weight =</span> <span class="st">&#39;length&#39;</span>,</span>
<span id="cb3-7"><a href="#cb3-7"></a>                           <span class="dt">matrice_type =</span> <span class="st">&#39;W&#39;</span>,</span>
<span id="cb3-8"><a href="#cb3-8"></a>                           <span class="dt">grid_shape =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb3-9"><a href="#cb3-9"></a>                           <span class="dt">verbose=</span><span class="ot">FALSE</span>)</span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a>Test &lt;-<span class="st"> </span><span class="kw">moran.test</span>(lixels<span class="op">$</span>nbAccident, netlistw, <span class="dt">zero.policy =</span> T)</span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="kw">print</span>(<span class="kw">round</span>(Test<span class="op">$</span>estimate,<span class="dv">4</span>))</span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt; Moran I statistic       Expectation          Variance </span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">#&gt;            0.0510           -0.0003            0.0001</span></span></code></pre></div>
<p>The autocorrelation is week, this is due to the large distance used and the fact that the analyzed variable is not a counting variable (number of accidents). Indeed, the Moran I is supposed to be used on continuous variables.</p>
<p>One could go further and define its own function to convert distances into spatial weights</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>my_conv_func &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="cf">if</span> (x<span class="op">&gt;=</span><span class="dv">300</span>){</span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="kw">return</span>(<span class="dv">0</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a>  }<span class="cf">else</span>{</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="kw">return</span>(<span class="dv">1</span><span class="op">/</span>x<span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb4-6"><a href="#cb4-6"></a>  }</span>
<span id="cb4-7"><a href="#cb4-7"></a>}</span>
<span id="cb4-8"><a href="#cb4-8"></a></span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a>netlistw2 &lt;-<span class="st"> </span><span class="kw">network_listw</span>(lixels,mtl_network,</span>
<span id="cb4-11"><a href="#cb4-11"></a>                             <span class="dt">method =</span> <span class="st">&quot;ends&quot;</span>,</span>
<span id="cb4-12"><a href="#cb4-12"></a>                             <span class="dt">mindist =</span> <span class="dv">10</span>,</span>
<span id="cb4-13"><a href="#cb4-13"></a>                             <span class="dt">maxdistance =</span> <span class="dv">300</span>,</span>
<span id="cb4-14"><a href="#cb4-14"></a>                             <span class="dt">dist_func =</span> my_conv_func,</span>
<span id="cb4-15"><a href="#cb4-15"></a>                             <span class="dt">line_weight =</span> <span class="st">&#39;length&#39;</span>,</span>
<span id="cb4-16"><a href="#cb4-16"></a>                             <span class="dt">matrice_type =</span> <span class="st">&#39;W&#39;</span>,</span>
<span id="cb4-17"><a href="#cb4-17"></a>                             <span class="dt">grid_shape =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb4-18"><a href="#cb4-18"></a>                             <span class="dt">verbose=</span><span class="ot">FALSE</span>)</span>
<span id="cb4-19"><a href="#cb4-19"></a></span>
<span id="cb4-20"><a href="#cb4-20"></a>Test2 &lt;-<span class="st"> </span><span class="kw">moran.test</span>(lixels<span class="op">$</span>nbAccident, netlistw2, <span class="dt">zero.policy =</span> T)</span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="kw">print</span>(<span class="kw">round</span>(Test2<span class="op">$</span>estimate,<span class="dv">4</span>))</span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co">#&gt; Moran I statistic       Expectation          Variance </span></span>
<span id="cb4-23"><a href="#cb4-23"></a><span class="co">#&gt;            0.0516           -0.0003            0.0001</span></span></code></pre></div>
<p>To speed up calculation, one could use a multiprocessing plan defined with the package <strong>future</strong>. To do so, the study area is divided in rectangle (according to the parameter <em>grid_shape</em>), and each rectangle is treated separatly. A buffer is applied around the quadras to avoid edge effects.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># setting the multiprocess plan</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co"># future::plan(future::multiprocess(workers=4))</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># </span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co"># netlistw3 &lt;- network_listw.mc(lixels,lixels,</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#                              method = &quot;ends&quot;,</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#                              mindist = 10,</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#                              maxdistance = 300,</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#                              dist_func = my_conv_func,</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#                              line_weight = &#39;length&#39;,</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#                              matrice_type = &#39;W&#39;,</span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co">#                              grid_shape = c(3,3),</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="co">#                              verbose=FALSE)</span></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="co"># </span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co"># if (!inherits(future::plan(), &quot;sequential&quot;)) future::plan(future::sequential)</span></span></code></pre></div>
</div>
<div id="other-features" class="section level1">
<h1>Other features</h1>
<ul>
<li>The spatial matrices could be calculated for every type of geometries not only lines. Points can directly be used. For polygons, it is possible to use the centers of the geometries as starting points. One can also chose a distance and equally spaced starting points will be defined on the border of the polygons according to that distance.</li>
<li>The cost of traveling on a edge could be set to something else than “length”.</li>
<li>It is possible to specify directions on the network.</li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
