<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Details about NKDE • spNetwork</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Details about NKDE">
<meta property="og:description" content="spNetwork">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spNetwork</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Isochrones.html">Calculating isochrones</a>
    </li>
    <li>
      <a href="../articles/KNetworkFunctions.html">Network k Functions</a>
    </li>
    <li>
      <a href="../articles/NKDE.html">Network Kernel Density Estimate</a>
    </li>
    <li>
      <a href="../articles/NKDEdetailed.html">Details about NKDE</a>
    </li>
    <li>
      <a href="../articles/NetworkBuilding.html">Building graphs</a>
    </li>
    <li>
      <a href="../articles/SpatialWeightMatrices.html">Spatial Weight Matrices</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JeremyGelb/spNetwork/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="NKDEdetailed_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Details about NKDE</h1>
                        <h4 class="author">Jeremy Gelb</h4>
            
            <h4 class="date">2021-09-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JeremyGelb/spNetwork/blob/master/vignettes/NKDEdetailed.Rmd"><code>vignettes/NKDEdetailed.Rmd</code></a></small>
      <div class="hidden name"><code>NKDEdetailed.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The goal of this vignette is to present the differences between the three Network Kernel Density Estimation methods implemented in the package <strong>spNetwork</strong>.</p>
<p>For a more detailed description, the reader should (must) read the provided references.</p>
<p>Let us start with the definition of a simple situation with one event and a small network. The spatial coordinates are given in metres.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jeremygelb.github.io/spNetwork/">spNetwork</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/rgeos/">rgeos</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/">sp</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://maptools.r-forge.r-project.org/">maptools</a></span><span class="op">)</span>

<span class="co"># start with de definition of some lines</span>
<span class="va">wkt_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"LINESTRING (0.0 0.0, 5.0 0.0)"</span>,
  <span class="st">"LINESTRING (0.0 -5.0, 5.0 -5.0)"</span>,
  <span class="st">"LINESTRING (5.0 0.0, 5.0 5.0)"</span>,
  <span class="st">"LINESTRING (5.0 -5.0, 5.0 -10.0)"</span>,
  <span class="st">"LINESTRING (5.0 0.0, 5.0 -5.0)"</span>,
  <span class="st">"LINESTRING (5.0 0.0, 10.0 0.0)"</span>,
  <span class="st">"LINESTRING (5.0 -5.0, 10.0 -5.0)"</span>,
  <span class="st">"LINESTRING (10.0 0, 10.0 -5.0)"</span>,
  <span class="st">"LINESTRING (10.0 -10.0, 10.0 -5.0)"</span>,
  <span class="st">"LINESTRING (15.0 -5.0, 10.0 -5.0)"</span>,
  <span class="st">"LINESTRING (10.0 0.0, 15.0 0.0)"</span>,
  <span class="st">"LINESTRING (10.0 0.0, 10.0 5.0)"</span><span class="op">)</span>

<span class="va">linesdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>wkt <span class="op">=</span> <span class="va">wkt_lines</span>,
                      id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"l"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">wkt_lines</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>

<span class="va">geoms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">linesdf</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span>
      <span class="va">txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">linesdf</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">$</span><span class="va">wkt</span><span class="op">)</span>
      <span class="va">geom</span> <span class="op">&lt;-</span> <span class="fu">rgeos</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rgeos/man/wkt-functions.html">readWKT</a></span><span class="op">(</span><span class="va">txt</span>,id<span class="op">=</span><span class="va">i</span><span class="op">)</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">geom</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span><span class="op">)</span>

<span class="va">all_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialLines.html">SpatialLinesDataFrame</a></span><span class="op">(</span><span class="va">geoms</span>, <span class="va">linesdf</span>,match.ID <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co"># and the definition of one event</span>
<span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,
                    y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.5</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">event</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">event</span><span class="op">$</span><span class="va">x</span>,<span class="va">event</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>

<span class="co"># and map the situation</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="fu">sp</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">all_lines</span><span class="op">)</span>
<span class="fu">sp</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">event</span>,add<span class="op">=</span><span class="cn">T</span>,col<span class="op">=</span><span class="st">"red"</span>,pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></code></pre></div>
<p><img src="NKDEdetailed_files/figure-html/unnamed-chunk-1-1.png" width="288"></p>
</div>
<div id="the-simple-method" class="section level1">
<h1 class="hasAnchor">
<a href="#the-simple-method" class="anchor"></a>The simple method</h1>
<p>The first method was proposed by <span class="citation">Xie and Yan (<a href="#ref-xie2008kernel" role="doc-biblioref">2008</a>)</span>. The differences with a classical KDE are:</p>
<ul>
<li>the events are snapped on a network</li>
<li>the distances between sampling points and events are network distance (ie. not euclidean distance)</li>
</ul>
<p>To get a good grasp of it, we calculate here the density values and plot them in 3D. We sample the kernel values at each one centimeter on the lines.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">samples_pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lines_points_along.html">lines_points_along</a></span><span class="op">(</span><span class="va">all_lines</span>,<span class="fl">0.01</span><span class="op">)</span>

<span class="va">simple_kernel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nkde.html">nkde</a></span><span class="op">(</span><span class="va">all_lines</span>, <span class="va">event</span>, w <span class="op">=</span> <span class="fl">1</span>,
                  samples <span class="op">=</span> <span class="va">samples_pts</span>, kernel_name <span class="op">=</span> <span class="st">"quartic"</span>, 
                  bw <span class="op">=</span> <span class="fl">10</span>, method <span class="op">=</span> <span class="st">"simple"</span>, div <span class="op">=</span> <span class="st">"bw"</span>, 
                  digits <span class="op">=</span> <span class="fl">3</span>, tol <span class="op">=</span> <span class="fl">0.001</span>, grid_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,
                  check <span class="op">=</span> <span class="cn">FALSE</span>,
                  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Let us see this in 3D !</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">plot3D</span><span class="op">)</span>

<span class="va">zfactor</span> <span class="op">&lt;-</span> <span class="fl">1000</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># step1 : plot the lines</span>
<span class="va">lines_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">all_lines</span><span class="op">)</span>
<span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lines_coords</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">ci</span> <span class="op">&lt;-</span> <span class="va">lines_coords</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
  <span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x0</span>,<span class="va">ci</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
  <span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">y0</span>,<span class="va">ci</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>
  <span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x1</span>,<span class="va">ci</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
  <span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">y1</span>,<span class="va">ci</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">z0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x0</span><span class="op">)</span><span class="op">)</span>
<span class="va">z1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/plot3D/man/arrows3D.html">segments3D</a></span><span class="op">(</span><span class="va">x0</span>,<span class="va">y0</span>,<span class="va">z0</span>,<span class="va">x1</span>,<span class="va">y1</span>,<span class="va">z1</span>,
           zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span><span class="op">)</span>,
           phi <span class="op">=</span> <span class="fl">15</span>,
           theta <span class="op">=</span> <span class="fl">30</span>,
           axes <span class="op">=</span> <span class="cn">FALSE</span>,
           border <span class="op">=</span> <span class="cn">NA</span>,
           box <span class="op">=</span> <span class="cn">FALSE</span>,
           r <span class="op">=</span> <span class="fl">0</span>
           <span class="op">)</span>

<span class="co"># step2 : add the event</span>
<span class="va">coords_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">event</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/plot3D/man/scatter.html">scatter3D</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">coords_events</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,
          y <span class="op">=</span> <span class="va">coords_events</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,
          z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">event</span><span class="op">)</span><span class="op">)</span>,
          col<span class="op">=</span><span class="st">"red"</span>,
          add<span class="op">=</span><span class="cn">T</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span>

<span class="co"># step3 : add the samples</span>
<span class="va">coords_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">samples_pts</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/plot3D/man/scatter.html">scatter3D</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">coords_samples</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,
          y <span class="op">=</span> <span class="va">coords_samples</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,
          z <span class="op">=</span> <span class="va">simple_kernel</span> <span class="op">*</span> <span class="va">zfactor</span>,
          col<span class="op">=</span><span class="st">"blue"</span>,
          cex<span class="op">=</span><span class="fl">0.1</span>,
          pch <span class="op">=</span> <span class="fl">19</span>,
          add<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="NKDEdetailed_files/figure-html/unnamed-chunk-3-1.png" width="50%"></p>
<p>As one can see, NKDE is only determined by the distance between the sampling points and the event. This is a problem, because at intersections, the event’s mass is multiplied by the number of edges at that intersection. In more mathematical words, this is not a true kernel because it does not integrate to 1 on its domain.</p>
<p>This method remains useful for two reasons:</p>
<ul>
<li>With big datasets, it might be useful to use this simple method to do a primary investigation (quick calculation).</li>
<li>In a purely geographical view, this method is intuitive. In the case of crime analysis for example, one could argue that the <em>strength</em> of the event should not be affected by intersections on the network. In that case, the kernel function can be seen as a distance decaying function.</li>
</ul>
<p><strong>What to retain about the simple method</strong></p>
<table class="table">
<thead><tr class="header">
<th align="center">Pros</th>
<th align="center">Cons</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">quick to calculate</td>
<td align="center">biased (not a true kernel)</td>
</tr>
<tr class="even">
<td align="center">intuitive</td>
<td align="center">overestimate the densities</td>
</tr>
<tr class="odd">
<td align="center">continuous</td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div id="the-discontinuous-method" class="section level1">
<h1 class="hasAnchor">
<a href="#the-discontinuous-method" class="anchor"></a>The discontinuous method</h1>
<p>To overcome the limits of the previous method, <span class="citation">Okabe and Sugihara (<a href="#ref-okabe2012spatial" role="doc-biblioref">2012</a>)</span> have proposed the discontinuous NKDE, which has been extended by <span class="citation">Sugihara, Satoh, and Okabe (<a href="#ref-sugihara2010simple" role="doc-biblioref">2010</a>)</span> for cases where the network has cycles shorter than the bandwidth.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">discontinuous_kernel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nkde.html">nkde</a></span><span class="op">(</span><span class="va">all_lines</span>, <span class="va">event</span>, w <span class="op">=</span> <span class="fl">1</span>,
                  samples <span class="op">=</span> <span class="va">samples_pts</span>, kernel_name <span class="op">=</span> <span class="st">"quartic"</span>, 
                  bw <span class="op">=</span> <span class="fl">10</span>, method <span class="op">=</span> <span class="st">"discontinuous"</span>, div <span class="op">=</span> <span class="st">"bw"</span>, 
                  digits <span class="op">=</span> <span class="fl">3</span>, tol <span class="op">=</span> <span class="fl">0.001</span>, grid_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,
                  check <span class="op">=</span> <span class="cn">FALSE</span>,
                  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="NKDEdetailed_files/figure-html/unnamed-chunk-5-1.png" width="50%"></p>
<p>As one can see, the values of the NKDE are split at intersections to avoid the multiplication of the mass observed in the simple version. However, this NKDE is discontinuous, which is counter-intuitive, and leads to sharp differences between density values in the network, and could be problematic in networks with numerous and close intersections.</p>
<p><strong>What to retain about the discontinuous method</strong></p>
<table class="table">
<thead><tr class="header">
<th align="center">Pros</th>
<th align="center">Cons</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">quick to calculate</td>
<td align="center">counter-intuitive</td>
</tr>
<tr class="even">
<td align="center">unbiased</td>
<td align="center">discontinuous</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center">contrasted results</td>
</tr>
</tbody>
</table>
</div>
<div id="the-continuous-method" class="section level1">
<h1 class="hasAnchor">
<a href="#the-continuous-method" class="anchor"></a>The continuous method</h1>
<p>Finally, the continuous method takes the best of the two worlds: it adjusts the values of the NKDE at intersections to ensure that it integrates to one on its domain, and applies a backward correction to force the density values to be continuous. This process is accomplished by a recursive function, described in the book <em>Spatial Analysis Along Networks</em> <span class="citation">(Okabe and Sugihara <a href="#ref-okabe2012spatial" role="doc-biblioref">2012</a>)</span>. This function is very time consuming, so it might be necessary to stop it when the recursion is too deep. Considering that the kernel density is divided at each intersection, stopping the function at deep level 15 produces results that are almost equal to the true values.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">samples_pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lines_points_along.html">lines_points_along</a></span><span class="op">(</span><span class="va">all_lines</span>,<span class="fl">0.1</span><span class="op">)</span>

<span class="va">continuous_kernel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nkde.html">nkde</a></span><span class="op">(</span><span class="va">all_lines</span>, <span class="va">event</span>, w <span class="op">=</span> <span class="fl">1</span>,
                  samples <span class="op">=</span> <span class="va">samples_pts</span>, kernel_name <span class="op">=</span> <span class="st">"quartic"</span>, 
                  bw <span class="op">=</span> <span class="fl">10</span>, method <span class="op">=</span> <span class="st">"continuous"</span>, div <span class="op">=</span> <span class="st">"bw"</span>, 
                  digits <span class="op">=</span> <span class="fl">0</span>, tol <span class="op">=</span> <span class="fl">0.01</span>, grid_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,
                  check <span class="op">=</span> <span class="cn">FALSE</span>,
                  verbose <span class="op">=</span> <span class="cn">FALSE</span>, max_depth <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></code></pre></div>
<p><img src="NKDEdetailed_files/figure-html/unnamed-chunk-7-1.png" width="50%"></p>
<p>As one can see, the values of the NKDE are continuous, and the density values close to the events have been adjusted. This method produces smoother results than the discontinuous method.</p>
<p><strong>what to retain about the discontinuous method</strong></p>
<table class="table">
<thead><tr class="header">
<th align="center">Pros</th>
<th align="center">Cons</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">unbiased</td>
<td align="center">long calculation time</td>
</tr>
<tr class="even">
<td align="center">continuous</td>
<td align="center">smoother values</td>
</tr>
</tbody>
</table>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-okabe2012spatial">
<p>Okabe, Atsuyuki, and Kokichi Sugihara. 2012. <em>Spatial Analysis Along Networks: Statistical and Computational Methods</em>. John Wiley &amp; Sons.</p>
</div>
<div id="ref-sugihara2010simple">
<p>Sugihara, Kokichi, Toshiaki Satoh, and Atsuyuki Okabe. 2010. “Simple and Unbiased Kernel Function for Network Analysis.” In <em>2010 10th International Symposium on Communications and Information Technologies</em>, 827–32. IEEE.</p>
</div>
<div id="ref-xie2008kernel">
<p>Xie, Zhixiao, and Jun Yan. 2008. “Kernel Density Estimation of Traffic Accidents in a Network Space.” <em>Computers, Environment and Urban Systems</em> 32 (5): 396–406.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jeremy Gelb.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
