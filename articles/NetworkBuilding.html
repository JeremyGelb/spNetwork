<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Building graphs • spNetwork</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Building graphs">
<meta property="og:description" content="spNetwork">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spNetwork</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Isochrones.html">Calculating isochrones</a>
    </li>
    <li>
      <a href="../articles/KNetworkFunctions.html">Network k Functions</a>
    </li>
    <li>
      <a href="../articles/NKDE.html">Network Kernel Density Estimate</a>
    </li>
    <li>
      <a href="../articles/NKDEdetailed.html">Details about NKDE</a>
    </li>
    <li>
      <a href="../articles/NetworkBuilding.html">Building graphs</a>
    </li>
    <li>
      <a href="../articles/SpatialWeightMatrices.html">Spatial Weight Matrices</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JeremyGelb/spNetwork/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="NetworkBuilding_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Building graphs</h1>
                        <h4 class="author">Jeremy Gelb</h4>
            
            <h4 class="date">2021-10-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JeremyGelb/spNetwork/blob/master/vignettes/NetworkBuilding.Rmd"><code>vignettes/NetworkBuilding.Rmd</code></a></small>
      <div class="hidden name"><code>NetworkBuilding.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The goal of this vignette is to present how several functions in <strong>spNetwork</strong> can be used to build graphs and to analyze it.</p>
<p>To illustrate the process, we give a full example with the calculation of the correlation between the centrality of bike accidents in the Montreal network and the NKDE density calculated at each accident point. Here are the steps we will follow to perform this analysis:</p>
<ol style="list-style-type: decimal">
<li>Calculating the NKDE density of accidents at each accident point</li>
<li>Snapping the accidents to the network</li>
<li>Cutting the lines of the network at the snapped accidents’ locations</li>
<li>Building a graph with the cut lines</li>
<li>Calculating for each node of the graph its centrality (betweenness)</li>
<li>Calculating the correlation between the NKDE density and the centrality measure.</li>
</ol>
<p>Let us start by loading some data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># first load data and packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/">sp</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://maptools.r-forge.r-project.org/">maptools</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/rgeos/">rgeos</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jeremygelb.github.io/spNetwork/">spNetwork</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mtennekes/tmap">tmap</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">FNN</span><span class="op">)</span>

<span class="va">networkgpkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"networks.gpkg"</span>,
                           package <span class="op">=</span> <span class="st">"spNetwork"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">eventsgpkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"events.gpkg"</span>,
                          package <span class="op">=</span> <span class="st">"spNetwork"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">mtl_network</span> <span class="op">&lt;-</span> <span class="fu">rgdal</span><span class="fu">::</span><span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/readOGR.html">readOGR</a></span><span class="op">(</span><span class="va">networkgpkg</span>,layer<span class="op">=</span><span class="st">"mtl_network"</span>,verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">bike_accidents</span> <span class="op">&lt;-</span> <span class="fu">rgdal</span><span class="fu">::</span><span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/readOGR.html">readOGR</a></span><span class="op">(</span><span class="va">eventsgpkg</span>,layer<span class="op">=</span><span class="st">"bike_accidents"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># then plotting the data</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">mtl_network</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">bike_accidents</span>,add<span class="op">=</span><span class="cn">T</span>,col<span class="op">=</span><span class="st">'red'</span>,pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></code></pre></div>
<p><img src="NetworkBuilding_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
</div>
<div id="calculating-the-nkde-density" class="section level1">
<h1 class="hasAnchor">
<a href="#calculating-the-nkde-density" class="anchor"></a>Calculating the NKDE density</h1>
<p>This step is easy to perform with the basic functions of <strong>spNetwork</strong>. For the sake of simplicity, we select an arbitrary bandwidth of 300m and use the discontinuous kernel.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculating the density values</span>
<span class="va">densities</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nkde.html">nkde</a></span><span class="op">(</span><span class="va">mtl_network</span>, 
                  events <span class="op">=</span> <span class="va">bike_accidents</span>,
                  w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">)</span><span class="op">)</span>,
                  samples <span class="op">=</span> <span class="va">bike_accidents</span>,
                  kernel_name <span class="op">=</span> <span class="st">"quartic"</span>,
                  bw <span class="op">=</span> <span class="fl">300</span>, div<span class="op">=</span> <span class="st">"bw"</span>, 
                  method <span class="op">=</span> <span class="st">"discontinuous"</span>, digits <span class="op">=</span> <span class="fl">2</span>, tol <span class="op">=</span> <span class="fl">0.5</span>,
                  grid_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, max_depth <span class="op">=</span> <span class="fl">8</span>,
                  agg <span class="op">=</span> <span class="fl">5</span>,
                  sparse <span class="op">=</span> <span class="cn">TRUE</span>,
                  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">bike_accidents</span><span class="op">$</span><span class="va">density</span> <span class="op">&lt;-</span> <span class="va">densities</span> <span class="op">*</span> <span class="fl">1000</span>

<span class="co"># mapping the density values</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">mtl_network</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html">tm_lines</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"density"</span>, style <span class="op">=</span> <span class="st">"kmeans"</span>,
          n <span class="op">=</span> <span class="fl">6</span>, size <span class="op">=</span> <span class="fl">0.1</span>, palette <span class="op">=</span> <span class="st">"-RdYlBu"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </code></pre></div>
<p><img src="NetworkBuilding_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div id="snapping-the-accidents-to-the-network" class="section level1">
<h1 class="hasAnchor">
<a href="#snapping-the-accidents-to-the-network" class="anchor"></a>Snapping the accidents to the network</h1>
<p>For this step, we will use the function <code>snapPointsToLines2</code>. It is mainly based on the function <code>snapPointsToLines</code> from <strong>maptools</strong> but can be used for bigger datasets. Note that we create two index columns: <code>OID</code> for the accidents’ location and <code>LineID</code> for the network lines.</p>
<p>We will also start by aggregating the points that are too close to each other. We will aggregate all the points that are within a 5 metres radius.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bike_accidents</span><span class="op">$</span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">agg_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_points.html">aggregate_points</a></span><span class="op">(</span><span class="va">bike_accidents</span>, maxdist <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>

<span class="va">agg_points</span><span class="op">$</span><span class="va">OID</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">agg_points</span><span class="op">)</span>
<span class="va">mtl_network</span><span class="op">$</span><span class="va">LineID</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">mtl_network</span><span class="op">)</span>

<span class="va">snapped_accidents</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/snapPointsToLines2.html">snapPointsToLines2</a></span><span class="op">(</span><span class="va">agg_points</span>, 
                                        <span class="va">mtl_network</span>,
                                        <span class="st">"LineID"</span><span class="op">)</span></code></pre></div>
</div>
<div id="cutting-the-lines-of-the-network" class="section level1">
<h1 class="hasAnchor">
<a href="#cutting-the-lines-of-the-network" class="anchor"></a>Cutting the lines of the network</h1>
<p>The next step is to use the new points to cut the lines of the network.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/split_lines_at_vertex.html">split_lines_at_vertex</a></span><span class="op">(</span><span class="va">mtl_network</span>, 
                                   <span class="va">snapped_accidents</span>,
                                   <span class="va">snapped_accidents</span><span class="op">$</span><span class="va">nearest_line_id</span>,
                                   mindist <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></code></pre></div>
</div>
<div id="building-a-graph-with-the-cut-lines" class="section level1">
<h1 class="hasAnchor">
<a href="#building-a-graph-with-the-cut-lines" class="anchor"></a>Building a graph with the cut lines</h1>
<p>We can now build the graph from the cut lines.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_lines</span><span class="op">$</span><span class="va">OID</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">new_lines</span><span class="op">)</span>
<span class="va">new_lines</span><span class="op">$</span><span class="va">length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rgeos/man/misc-gLength.html">gLength</a></span><span class="op">(</span><span class="va">new_lines</span>, byid <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">graph_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_graph.html">build_graph</a></span><span class="op">(</span><span class="va">new_lines</span>, <span class="fl">2</span>, <span class="st">"length"</span>, attrs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="calculating-for-each-node-of-the-graph-its-centrality" class="section level1">
<h1 class="hasAnchor">
<a href="#calculating-for-each-node-of-the-graph-its-centrality" class="anchor"></a>Calculating for each node of the graph its centrality</h1>
<p>The graph can be used with the library <strong>igraph</strong>. We will calculate here the betweenness centrality of each node in the graph.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">btws</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/betweenness.html">betweenness</a></span><span class="op">(</span><span class="va">graph_result</span><span class="op">$</span><span class="va">graph</span>, directed <span class="op">=</span> <span class="cn">FALSE</span>,
                            normalized <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">vertices</span> <span class="op">&lt;-</span> <span class="va">graph_result</span><span class="op">$</span><span class="va">spvertices</span>
<span class="va">vertices</span><span class="op">$</span><span class="va">btws</span> <span class="op">&lt;-</span> <span class="va">btws</span>

<span class="co"># mapping the betweenness</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">vertices</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"btws"</span>, style <span class="op">=</span> <span class="st">"kmeans"</span>,
          n <span class="op">=</span> <span class="fl">6</span>, size <span class="op">=</span> <span class="fl">0.1</span>, palette <span class="op">=</span> <span class="st">"-RdYlBu"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </code></pre></div>
<p><img src="NetworkBuilding_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>The last step is to find for each of the original points its corresponding node. We will do it by using the k nearest neighbours approach with the package <strong>FNN</strong>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># first: nn merging between snapped points and nodes</span>
<span class="va">xy1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">snapped_accidents</span><span class="op">)</span>
<span class="va">xy2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">vertices</span><span class="op">)</span>
<span class="va">corr_nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/FNN/man/get.knn.html">get.knnx</a></span><span class="op">(</span><span class="va">xy2</span>, <span class="va">xy1</span>, k<span class="op">=</span><span class="fl">1</span><span class="op">)</span>

<span class="va">snapped_accidents</span><span class="op">$</span><span class="va">btws</span> <span class="op">&lt;-</span> <span class="va">vertices</span><span class="op">$</span><span class="va">btws</span><span class="op">[</span><span class="va">corr_nodes</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>

<span class="co"># second: nn merging between original points and snapped points</span>
<span class="va">xy1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">)</span>
<span class="va">xy2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">snapped_accidents</span><span class="op">)</span>

<span class="va">corr_nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/FNN/man/get.knn.html">get.knnx</a></span><span class="op">(</span><span class="va">xy2</span>, <span class="va">xy1</span>, k<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">bike_accidents</span><span class="op">$</span><span class="va">btws</span> <span class="op">&lt;-</span> <span class="va">snapped_accidents</span><span class="op">$</span><span class="va">btws</span><span class="op">[</span><span class="va">corr_nodes</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>

<span class="co"># mapping the results</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"btws"</span>, style <span class="op">=</span> <span class="st">"kmeans"</span>,
          n <span class="op">=</span> <span class="fl">6</span>, size <span class="op">=</span> <span class="fl">0.1</span>, palette <span class="op">=</span> <span class="st">"-RdYlBu"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="NetworkBuilding_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"density"</span>, style <span class="op">=</span> <span class="st">"kmeans"</span>,
          n <span class="op">=</span> <span class="fl">6</span>, size <span class="op">=</span> <span class="fl">0.1</span>, palette <span class="op">=</span> <span class="st">"-RdYlBu"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </code></pre></div>
<p><img src="NetworkBuilding_files/figure-html/unnamed-chunk-7-2.png" width="700"></p>
<p>And finally, we can calculate the correlation between the two variables !</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span><span class="op">(</span><span class="va">bike_accidents</span><span class="op">$</span><span class="va">density</span>, <span class="va">bike_accidents</span><span class="op">$</span><span class="va">btws</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  Pearson's product-moment correlation
## 
## data:  bike_accidents$density and bike_accidents$btws
## t = 2.0759, df = 345, p-value = 0.03865
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.005855796 0.213851736
## sample estimates:
##       cor 
## 0.1110699</code></pre>
<p>We can see that there is no correlation between the two variables. There is no association between the degree of centrality of an accident location in the network and the density of accidents in a radius of 300m at that location.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jeremy Gelb.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
